(this["webpackJsonpbilling-management"]=this["webpackJsonpbilling-management"]||[]).push([[0],{333:function(e,t,n){},334:function(e,t,n){"use strict";n.r(t);var i=n(2),s=n.n(i),r=n(77),a=n.n(r),o=n(4),l=n(5),c=n(6),d=n(13),u=n(14),h=n(20),b=n(25),p=n(18),v=n(1),m=n(3),j=n.n(m),f=n(7),g=n(8),x=(n(343),n(341),new(function(){function e(){Object(o.a)(this,e),this.subscribers=[],window.addEventListener("message",this.handleIncomingMessage.bind(this))}return Object(l.a)(e,[{key:"subscribe",value:function(e,t){this.subscribers[e]=t}},{key:"handleIncomingMessage",value:function(e){var t=this;if(e&&e.data){var n=this.subscribers[e.data.query];if(n){var i=function(){};if("getSubscription"!==e.data.query||e.data.response||(e.data.response="subscription"),"routeUpdate"===e.data.query&&e.data.response)return n(e.data.response);e.data.response&&(i=function(n){var i={};i[e.data.response]=n,t.sendMessage(i)}),n(i)}}}},{key:"sendMessage",value:function(e){(null===e||void 0===e?void 0:e.errors)||window.parent.postMessage(e,"*")}},{key:"getToken",value:function(){var e=Object(f.a)(j.a.mark((function e(){var t;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.sendMessage,e.abrupt("return",new Promise((function(e){window.addEventListener("message",(function t(n){n.data&&"token"===n.data.request&&(window.removeEventListener("message",t),e(n.data.response))})),t({request:"token"})})));case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getForceUpgradeInfo",value:function(){var e=Object(f.a)(j.a.mark((function e(){var t,n;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new AbortController,n=this.sendMessage,e.abrupt("return",new Promise((function(e){window.addEventListener("message",(function t(n){n.data&&"forceUpgradeInfo"===n.data.request&&(window.removeEventListener("message",t),e(n.data.response))}),{signal:t.signal}),n({request:"forceUpgradeInfo"}),setTimeout((function(){t.abort(),e({})}),2e3)})));case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"sendSubscriptionData",value:function(){var e=Object(f.a)(j.a.mark((function e(t){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=4;break}return e.next=3,X();case 3:t=e.sent;case 4:if(!t.errors){e.next=6;break}return e.abrupt("return");case 6:this.sendMessage(t);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}())),O=n(82),y=n.n(O),k=function(){var e=Object(f.a)(j.a.mark((function e(t){var n,i,s,r,a,o;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=null,!(null===t||void 0===t?void 0:t.init)&&!(null===t||void 0===t?void 0:t.refresh)){e.next=8;break}return e.next=4,x.getToken();case 4:if(null!==(n=e.sent)){e.next=8;break}return i=new y.a.UnauthorizedError({message:"Only the site owner can access billing information."}),e.abrupt("return",{errors:i});case 8:return e.prev=8,e.next=11,window.fetch("/api/billing-session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:n,options:t})});case 11:return s=e.sent,e.next=14,s.json();case 14:if(r=e.sent,s.ok){e.next=18;break}if(!r||!r.errors||"Token has expired"!==r.errors.message){e.next=18;break}return e.abrupt("return",k.call(undefined,{refresh:!0}));case 18:if(!r.error||403!==r.error.status){e.next=24;break}return console.log(r.error),a=new y.a.UnauthorizedError({message:"Only the site owner can access billing information."}),e.abrupt("return",{errors:a});case 24:if(!r.error){e.next=28;break}return console.log(r.error),o=new y.a.NoPermissionError({message:"Error receiving billing data, please contact support@ghost.org"}),e.abrupt("return",{errors:o});case 28:return e.abrupt("return",n);case 31:return e.prev=31,e.t0=e.catch(8),e.abrupt("return",{errors:e.t0});case 34:case"end":return e.stop()}}),e,null,[[8,31]])})));return function(t){return e.apply(this,arguments)}}(),S=k,w=function(e){return Number.parseFloat(e).toFixed(2)},N=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.fixed,i=t.symbol;if(e||0===e){if(e=(e=n?w(e):e.toString().replace(/(\d*)(\.0+)$/,"$1")).toString(),i){e=i+e;var s="(\\"+i+"?)(-?)",r=new RegExp(s);e=e.replace(r,"$2$1")}for(var a=/(-?\d+)(\d{3})/;a.test(e);)e=e.replace(a,"$1,$2");return e}},A=function(e){var t=[];if(e&&e.length){var n=e.filter((function(e){return e.name="members"}))[0];parseInt(n.value,10)>=1e6?t.push("Up to ".concat(parseInt(n.value,10)/1e6,"M members")):t.push("Up to ".concat(N(n.value)," members"))}return t},C={Starter:["25k views/month","1 staff user","Up to 1,000 members","SSL+CDN included"],Basic:["100k views/month","2 staff users","Custom themes","Custom integrations"],Standard:["500k views/month","5 staff users","8,000 members","Priority support"],Business:["1M views/month","Unlimited staff users","35,000 members","99.9% uptime SLA"]},P={Starter:["1 staff user","Free, official Ghost themes","Standard built-in integrations"],Creator:["Everything in Starter","2 staff users","Unlimited custom themes","1,000+ Zapier integrations","Build custom integrations"],Team:["Everything in Creator","5 staff users","Priority support","More business tools"],Business:["Everything in Team","Unlimited staff users","Advanced domain configs","99.9% uptime SLA"]};function M(e){var t=Object.assign({},e);if(t.legacy){var n,i=null===t||void 0===t||null===(n=t.nickname)||void 0===n?void 0:n.split(" ")[0];C[i]&&C[i].length&&(t.features=C[i])}else t.features=P[e.name];return t.prices&&t.prices.length?t.prices.forEach((function(e){e.features=A(e.limits)})):(null===t||void 0===t?void 0:t.base_product)&&(null===t||void 0===t?void 0:t.limits)&&(t.features=A(t.limits)),t.addons&&t.addons.length&&(t.addons=t.addons.map((function(e){return function(e){return e.name.toLowerCase().indexOf("subdirectory")>=0?Object(v.a)(Object(v.a)({},e),{},{name:"Subdirectory install",description:'If you have an existing site \u2014 for example a shop, or a static site hosted elsewhere \u2014 Ghost can be run from a separate location e.g. <code>yourdomain.com/blog</code> otherwise known as a subdirectory. <a href="https://ghost.org/help/can-i-run-ghost-from-a-subdirectory/" target="_blank" rel="noopener noreferrer">Learn more</a>.'}):e}(e)}))),t}var _=n(153),I=n.n(_);function T(e){var t,n,i=e.exceededLimits,s=e.currentSiteLimits,r=(null===e||void 0===e||null===(t=e.subscription)||void 0===t?void 0:t.customer_id)||(null===e||void 0===e||null===(n=e.user)||void 0===n?void 0:n.stripe_token),a=null;try{a=window.localStorage.getItem("gh_checkout_".concat(r))}catch(E){console.error("Unable to read local storage",E)}if(a){var o=a=I()(a),l=o.product,c=o.period,d=o.priceId;return e.pendingSubscription={product:"".concat(l[0].toUpperCase()).concat(l.substring(1)),period:c,priceId:d},"/checkout/".concat(l.toLowerCase(),"-").concat(c)}var u,h,b,p,v,m,j,f,g,x,O,y=(null===e||void 0===e||null===(u=e.subscription)||void 0===u||null===(h=u.meta)||void 0===h||null===(b=h.baseProduct)||void 0===b?void 0:b.name.toLowerCase())||"starter",k=(null===e||void 0===e||null===(p=e.subscription)||void 0===p||null===(v=p.meta)||void 0===v||null===(m=v.baseProduct)||void 0===m?void 0:m.billing_period)||"year";if(((null===e||void 0===e||null===(j=e.currentPrice)||void 0===j?void 0:j.legacy)||"personal"===y)&&"personal"===(y="starter")&&(k="year"),"starter"===y&&"incomplete"!==(null===e||void 0===e||null===(f=e.subscription)||void 0===f?void 0:f.status)&&(null===i||void 0===i?void 0:i.length)>=1&&(i.includes("members")&&(null===s||void 0===s||null===(g=s.members)||void 0===g?void 0:g.total)>=1e3||i.includes("customThemes")||!(null===s||void 0===s||null===(x=s.customThemes)||void 0===x?void 0:x.hasOfficialTheme)||i.includes("customIntegrations"))&&(y="creator"),"incomplete"===(null===e||void 0===e||null===(O=e.subscription)||void 0===O?void 0:O.status)){var S,w,N,A,C,P,M,_,T,D={product:"".concat(null===e||void 0===e||null===(S=e.subscription)||void 0===S||null===(w=S.meta)||void 0===w||null===(N=w.baseProduct)||void 0===N?void 0:N.name[0].toUpperCase()).concat(null===e||void 0===e||null===(A=e.subscription)||void 0===A||null===(C=A.meta)||void 0===C||null===(P=C.baseProduct)||void 0===P?void 0:P.name.substring(1)),period:k,priceId:(null===e||void 0===e||null===(M=e.subscription)||void 0===M||null===(_=M.meta)||void 0===_||null===(T=_.baseProduct)||void 0===T?void 0:T.stripe_price_id)||null};e.pendingSubscription=D;try{window.localStorage.setItem("gh_checkout_".concat(r),JSON.stringify(D))}catch(E){console.error("Unable to set local storage",E)}}return"/checkout/".concat(y,"-").concat(k)}function D(e,t){var n,i,s=e.subscription;if(!s||!(null===s||void 0===s?void 0:s.status)||!t||!(null===t||void 0===t?void 0:t.status))return{};var r=s.status,a="trialing"===r,o="active"===r,l="incomplete"===r,c="past_due"===r||"unpaid"===r,d="canceled"===r||!a&&!o&&!c&&!l,u=!1;if("active"!==s.status||"open"!==(null===t||void 0===t?void 0:t.status)||"requires_action"!==(null===t||void 0===t||null===(n=t.payment_intent)||void 0===n?void 0:n.status)&&"requires_payment_method"!==(null===t||void 0===t||null===(i=t.payment_intent)||void 0===i?void 0:i.status)){if("paid"===(null===t||void 0===t?void 0:t.status)||"void"===(null===t||void 0===t?void 0:t.status)||"incomplete_expired"===(null===s||void 0===s?void 0:s.status)){var h;false;var b=(null===s||void 0===s?void 0:s.customer_id)||(null===e||void 0===e||null===(h=e.user)||void 0===h?void 0:h.stripe_token);try{window.localStorage.removeItem("gh_checkout_".concat(b))}catch(p){console.error("Unable to remove item from local storage",p)}u=!1}}else u=!0;return{isTrial:a,isActive:o,isIncomplete:l,isInactive:d,isGrace:c,isPending:u}}x.subscribe("getSubscription",(function(e){K("subscription").then((function(t){return e({subscription:t})}))}));var E=null,U=null,L=!1,B={users:X.bind(),blogs:X.bind(),subscription:X.bind(),currentSite:ee.bind(),currentSiteLimits:ee.bind(),currentProduct:ne.bind(),availableProducts:ne.bind(),invoices:ae.bind(),invoiceDetails:se.bind(),latestInvoice:me.bind()},F=function(){var e=Object(f.a)(j.a.mark((function e(t){var n,i,s,r,a,o,l,c,d;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.uri,i=t.data,s=t.headers,r=t.options,a=t.token){e.next=8;break}return e.next=4,S();case 4:if((o=e.sent)&&!(null===o||void 0===o?void 0:o.errors)){e.next=7;break}return e.abrupt("return");case 7:a=o;case 8:if(l=JSON.stringify({token:a,data:i,options:r}),s||(s={"Content-Type":"application/json"}),n){e.next=12;break}throw new Error("Endpoint must be provided");case 12:return e.next=14,window.fetch(n,{method:"POST",headers:s,body:l});case 14:if(c=e.sent){e.next=17;break}throw new Error("No response received");case 17:if(202!==(null===c||void 0===c?void 0:c.status)&&204!==(null===c||void 0===c?void 0:c.status)){e.next=19;break}return e.abrupt("return",c);case 19:return e.next=21,c.json();case 21:if(d=e.sent,c.ok){e.next=29;break}if(!d||!d.errors||"Token has expired"!==d.errors.message){e.next=29;break}return e.next=26,S({refresh:!0});case 26:return a=e.sent,U=a,e.abrupt("return",F.call(undefined,{uri:n,data:i,token:a}));case 29:return e.abrupt("return",d);case 31:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();function R(e){return G.apply(this,arguments)}function G(){return(G=Object(f.a)(j.a.mark((function e(t){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return E=Object(v.a)(Object(v.a)({},E),{},{forceUpgradeNoOwner:!1===t.isOwner&&!0===t.forceUpgrade,forceUpgradeOwner:!0===t.isOwner&&!0===t.forceUpgrade,isForceUpgrade:!0===t.forceUpgrade,siteOwner:null===t||void 0===t?void 0:t.ownerUser}),e.abrupt("return",E);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function V(){return H.apply(this,arguments)}function H(){return(H=Object(f.a)(j.a.mark((function e(){var t;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.getForceUpgradeInfo();case 2:return t=e.sent,e.next=6,R(t);case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function W(e,t){return z.apply(this,arguments)}function z(){return(z=Object(f.a)(j.a.mark((function e(t,n){var i;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("Function must be called with a model identifier");case 2:if(B[t]){e.next=4;break}throw new Error("Not a valid model identifier '".concat(t,"'"));case 4:return e.next=6,B[t].apply(n);case 6:return i=e.sent,E=Object(v.a)(Object(v.a)({},E),i),e.abrupt("return",E[t]);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function K(e){return q.apply(this,arguments)}function q(){return(q=Object(f.a)(j.a.mark((function e(t){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("Function must be called with a model identifier");case 2:if(E){e.next=5;break}return e.next=5,J();case 5:if(B[t]){e.next=7;break}throw new Error("Not a valid model identifier '".concat(t,"'"));case 7:if(E[t]){e.next=10;break}return e.next=10,W(t);case 10:return e.abrupt("return",E[t]);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Y(){return Z.apply(this,arguments)}function Z(){return(Z=Object(f.a)(j.a.mark((function e(){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(E){e.next=4;break}return e.next=3,J();case 3:return e.abrupt("return",e.sent);case 4:return e.abrupt("return",E);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function J(){return Q.apply(this,arguments)}function Q(){return(Q=Object(f.a)(j.a.mark((function e(){var t,n,i,s,r,a,o,l,c,d,u,h,b,p,m,f,g,O,y,k;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,S({init:!0});case 3:if((d=e.sent)&&!(null===d||void 0===d?void 0:d.errors)){e.next=7;break}return E.errors={message:(null===d||void 0===d||null===(u=d.errors)||void 0===u?void 0:u.message)||"Error receiving billing data, no permission"},e.abrupt("return",E);case 7:return U=d,e.next=10,x.getForceUpgradeInfo();case 10:if(!(h=e.sent)){e.next=16;break}return e.next=14,R(h);case 14:if(!(null===(b=E)||void 0===b?void 0:b.forceUpgradeNoOwner)){e.next=16;break}return e.abrupt("return",E);case 16:return e.next=18,X({initialRequest:!0});case 18:if(!(p=e.sent).errors||403!==p.errors.status){e.next=23;break}return L=!0,e.abrupt("return",p);case 23:return L=!1,e.next=26,ne({stripePrice:null===(t=E)||void 0===t||null===(n=t.subscription)||void 0===n||null===(i=n.meta)||void 0===i||null===(s=i.baseProduct)||void 0===s?void 0:s.stripe_price_id});case 26:if(m=e.sent,!(null===(r=E)||void 0===r?void 0:r.forceUpgradeOwner)){e.next=31;break}e.t0={},e.next=34;break;case 31:return e.next=33,se({customerId:null===(a=E)||void 0===a||null===(o=a.subscription)||void 0===o?void 0:o.customer_id});case 33:e.t0=e.sent;case 34:return f=e.t0,e.next=37,ae({userId:null===(l=E)||void 0===l||null===(c=l.user)||void 0===c?void 0:c.id});case 37:return g=e.sent,e.next=40,ee({data:E.blogs});case 40:O=e.sent,(E=Object(v.a)(Object(v.a)(Object(v.a)(Object(v.a)(Object(v.a)(Object(v.a)({},E),p),m),g),O),f)).checkoutRoute=T(E),e.next=49;break;case 45:e.prev=45,e.t1=e.catch(0),(E=E||{}).errors={message:(null===e.t1||void 0===e.t1||null===(y=e.t1.errors)||void 0===y?void 0:y.message)||"Error receiving billing data",status:null===e.t1||void 0===e.t1||null===(k=e.t1.errors)||void 0===k?void 0:k.status,originalError:e.t1};case 49:if(E.availableProducts||E.errors){e.next=51;break}return e.abrupt("return",E.errors={message:"Error receiving billing data"});case 51:return e.next=53,x.sendSubscriptionData(E);case 53:return e.abrupt("return",E);case 55:case"end":return e.stop()}}),e,null,[[0,45]])})))).apply(this,arguments)}function X(){return $.apply(this,arguments)}function $(){return($=Object(f.a)(j.a.mark((function e(){var t,n,i,s,r,a,o,l,c,d,u,h,b,p,m,f,g=arguments;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=g.length>0&&void 0!==g[0]?g[0]:{},n={},E.forceUpgradeOwner&&(t.forceUpgrade=!0),(null===t||void 0===t?void 0:t.initialRequest)||!L){e.next=6;break}return e.abrupt("return",E);case 6:return e.prev=6,e.next=9,F({uri:"/api/get-subscription",options:t,token:U});case 9:if(!(n=e.sent).errors||403!==n.errors.status){e.next=14;break}return L=!0,e.abrupt("return",n);case 14:return L=!1,e.next=17,me({customerId:(null===(i=n)||void 0===i||null===(s=i.subscription)||void 0===s?void 0:s.customer_id)||(null===(r=n)||void 0===r||null===(a=r.user)||void 0===a?void 0:a.stripe_token)});case 17:return b=e.sent,p=D(n,b),(null===b||void 0===b||null===(o=b.payment_intent)||void 0===o?void 0:o.client_secret)&&"canceled"===!(null===b||void 0===b||null===(l=b.payment_intent)||void 0===l?void 0:l.status)&&(n.subscription.meta.paymentIntentSecret=b.payment_intent.client_secret),"incomplete"===(null===(c=n)||void 0===c||null===(d=c.subscription)||void 0===d?void 0:d.status)&&"succeeded"===(null===t||void 0===t?void 0:t.sca)?n.subscription.status="active":(null===(u=n)||void 0===u?void 0:u.isPending)&&"succeeded"===(null===t||void 0===t?void 0:t.sca)&&(n.isPending=!1),E=Object(v.a)(Object(v.a)(Object(v.a)({},E),n),p),(null===(h=E)||void 0===h?void 0:h.subscription)&&(E.subscription.isActiveTrial=E.isTrial||E.isIncomplete),e.abrupt("return",E);case 27:e.prev=27,e.t0=e.catch(6),n.errors={message:(null===e.t0||void 0===e.t0||null===(m=e.t0.errors)||void 0===m?void 0:m.message)||"Error receiving subscription information",status:null===e.t0||void 0===e.t0||null===(f=e.t0.errors)||void 0===f?void 0:f.status,originalError:e.t0};case 30:if(E=Object(v.a)(Object(v.a)({},E),n),!t.updateAdmin){e.next=34;break}return e.next=34,x.sendSubscriptionData(E);case 34:return e.abrupt("return",E);case 35:case"end":return e.stop()}}),e,null,[[6,27]])})))).apply(this,arguments)}function ee(e){return te.apply(this,arguments)}function te(){return(te=Object(f.a)(j.a.mark((function e(t){var n,i,s,r,a,o,l,c,d,u,h,b,p,m,f;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a={},o={},l=(null===t||void 0===t?void 0:t.blogs)||(null===(n=E)||void 0===n?void 0:n.blogs),c=(null===(i=E)||void 0===i||null===(s=i.currentSite)||void 0===s?void 0:s.id)||null,!L){e.next=6;break}return e.abrupt("return",E);case 6:if(l){e.next=11;break}return e.next=9,X({initialRequest:!0});case 9:d=e.sent,l=null===d||void 0===d?void 0:d.blogs;case 11:return(null===(r=E)||void 0===r?void 0:r.forceUpgradeOwner)&&(a.forceUpgrade=!0),e.prev=12,e.next=15,F({uri:"/api/get-current-site",data:{blogs:l,siteId:c},options:a,token:U});case 15:if(!(o=e.sent).errors||!o.errors.message.match(/special legacy plan/)){e.next=18;break}return e.abrupt("return",o.errors);case 18:(null===(u=o)||void 0===u?void 0:u.currentSiteLimits)&&(h=Object.keys(o.currentSiteLimits),b=h.filter((function(e){return o.currentSiteLimits[e].exceeded})),E=Object(v.a)(Object(v.a)(Object(v.a)({},E),o),{},{exceededLimits:b}),p=T(E),E.checkoutRoute=p),e.next=24;break;case 21:e.prev=21,e.t0=e.catch(12),o.errors={message:(null===e.t0||void 0===e.t0||null===(m=e.t0.errors)||void 0===m?void 0:m.message)||"Error receiving current site information",status:null===e.t0||void 0===e.t0||null===(f=e.t0.errors)||void 0===f?void 0:f.status,originalError:e.t0};case 24:return e.abrupt("return",o);case 25:case"end":return e.stop()}}),e,null,[[12,21]])})))).apply(this,arguments)}function ne(e){return ie.apply(this,arguments)}function ie(){return(ie=Object(f.a)(j.a.mark((function e(t){var n,i,s,r,a,o,l,c,d,u,h,b,p,m,f,g,x,O;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o={},l=(null===t||void 0===t?void 0:t.stripePrice)||(null===(n=E)||void 0===n||null===(i=n.subscription)||void 0===i||null===(s=i.meta)||void 0===s||null===(r=s.baseProduct)||void 0===r?void 0:r.stripe_price_id),c=(null===t||void 0===t?void 0:t.availableProducts)||(null===(a=E)||void 0===a?void 0:a.availableProducts)||null,d=null,!L){e.next=6;break}return e.abrupt("return",E);case 6:if(l){e.next=11;break}return e.next=9,X();case 9:p=e.sent,l=null===p||void 0===p||null===(u=p.subscription)||void 0===u||null===(h=u.meta)||void 0===h||null===(b=h.baseProduct)||void 0===b?void 0:b.stripe_price_id;case 11:return e.prev=11,e.next=14,F({uri:"/api/get-current-plan",data:{stripePrice:l,availableProducts:c},token:U});case 14:return o=e.sent,(null===(m=o)||void 0===m?void 0:m.availableProducts)&&o.availableProducts.length&&(c=null===(f=o)||void 0===f?void 0:f.availableProducts.map(M)),(o.currentPrice&&!o.currentPrice.legacy||o.currentPrice&&o.currentPrice.legacy)&&(d=o.currentPrice?M(o.currentPrice):null),g={availableProducts:c,currentPrice:d},E=Object(v.a)(Object(v.a)({},E),g),e.abrupt("return",g);case 22:e.prev=22,e.t0=e.catch(11),o.errors={message:(null===e.t0||void 0===e.t0||null===(x=e.t0.errors)||void 0===x?void 0:x.message)||"Error receiving products and prices",status:null===e.t0||void 0===e.t0||null===(O=e.t0.errors)||void 0===O?void 0:O.status,originalError:e.t0};case 25:case"end":return e.stop()}}),e,null,[[11,22]])})))).apply(this,arguments)}function se(e){return re.apply(this,arguments)}function re(){return(re=Object(f.a)(j.a.mark((function e(t){var n,i,s,r,a;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s={},r=(null===t||void 0===t?void 0:t.customerId)||(null===(n=E)||void 0===n||null===(i=n.subscription)||void 0===i?void 0:i.customer_id),!L){e.next=4;break}return e.abrupt("return",E);case 4:if(r){e.next=9;break}return e.next=7,X();case 7:a=e.sent,r=null===a||void 0===a?void 0:a.subscription.customer_id;case 9:return e.prev=9,e.next=12,F({uri:"/api/get-invoice-details",data:{customerId:r},token:U});case 12:s=e.sent,e.next=18;break;case 15:e.prev=15,e.t0=e.catch(9),s.errors={message:"Error getting invoice details",originalError:e.t0};case 18:return e.abrupt("return",s);case 19:case"end":return e.stop()}}),e,null,[[9,15]])})))).apply(this,arguments)}function ae(e){return oe.apply(this,arguments)}function oe(){return(oe=Object(f.a)(j.a.mark((function e(t){var n,i,s,r;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i={},s=(null===t||void 0===t?void 0:t.userId)||(null===(n=E)||void 0===n?void 0:n.user.id),!L){e.next=4;break}return e.abrupt("return",E);case 4:if(s){e.next=9;break}return e.next=7,X();case 7:r=e.sent,s=null===r||void 0===r?void 0:r.user.id;case 9:return e.prev=9,e.next=12,F({uri:"/api/get-invoices",data:{userId:s},token:U});case 12:i=e.sent,e.next=19;break;case 15:e.prev=15,e.t0=e.catch(9),i.errors={message:"Error fetching invoices",originalError:e.t0};case 19:return e.abrupt("return",i);case 20:case"end":return e.stop()}}),e,null,[[9,15]])})))).apply(this,arguments)}function le(e){return ce.apply(this,arguments)}function ce(){return(ce=Object(f.a)(j.a.mark((function e(t){var n;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={},e.prev=1,e.next=4,F({uri:"/api/setup-card",data:t,token:U});case 4:n=e.sent,e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),n.errors={message:"Error updating credit card",originalError:e.t0};case 10:return e.abrupt("return",n);case 11:case"end":return e.stop()}}),e,null,[[1,7]])})))).apply(this,arguments)}function de(e){return ue.apply(this,arguments)}function ue(){return(ue=Object(f.a)(j.a.mark((function e(t){var n;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={},e.prev=1,e.next=4,F({uri:"/api/payment-method",data:t,token:U});case 4:n=e.sent,e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),n.errors={message:"Error confirming credit card",originalError:e.t0};case 10:return e.abrupt("return",n);case 11:case"end":return e.stop()}}),e,null,[[1,7]])})))).apply(this,arguments)}function he(e){return be.apply(this,arguments)}function be(){return(be=Object(f.a)(j.a.mark((function e(t){var n,i,s,r;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={},e.prev=1,e.next=4,F({uri:"/api/update-card",data:t,token:U});case 4:return n=e.sent,s=(i=n).user,r=i.errors,E=Object(v.a)(Object(v.a)({},E),{},{user:s,errors:r}),e.abrupt("return",E);case 10:e.prev=10,e.t0=e.catch(1),n.errors={message:"Error updating credit card",originalError:e.t0};case 13:return e.abrupt("return",n);case 14:case"end":return e.stop()}}),e,null,[[1,10]])})))).apply(this,arguments)}function pe(e){return ve.apply(this,arguments)}function ve(){return(ve=Object(f.a)(j.a.mark((function e(t){var n,i,s,r;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={},e.prev=1,e.next=4,F({uri:"/api/add-invoice-details",data:t,token:U});case 4:return n=e.sent,s=(i=n).invoiceDetails,r=i.errors,E=Object(v.a)(Object(v.a)({},E),{},{invoiceDetails:s,errors:r}),e.abrupt("return",E);case 10:e.prev=10,e.t0=e.catch(1),n.errors={message:"Error adding invoice details",originalError:e.t0};case 13:return e.abrupt("return",n);case 14:case"end":return e.stop()}}),e,null,[[1,10]])})))).apply(this,arguments)}function me(e){return je.apply(this,arguments)}function je(){return(je=Object(f.a)(j.a.mark((function e(t){var n;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={},e.prev=1,e.next=4,F({uri:"/api/get-latest-invoice",data:t,token:U});case 4:n=e.sent,e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),n.errors={message:"Error fetching latest invoice",originalError:e.t0};case 10:return e.abrupt("return",n);case 11:case"end":return e.stop()}}),e,null,[[1,7]])})))).apply(this,arguments)}function fe(e){return ge.apply(this,arguments)}function ge(){return(ge=Object(f.a)(j.a.mark((function e(t){var n;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={},e.prev=1,e.next=4,F({uri:"/api/get-invoice-preview",data:t,token:U});case 4:n=e.sent,e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),n.errors={message:"Error fetching invoice preview",originalError:e.t0};case 10:return e.abrupt("return",n);case 11:case"end":return e.stop()}}),e,null,[[1,7]])})))).apply(this,arguments)}function xe(e){return Oe.apply(this,arguments)}function Oe(){return(Oe=Object(f.a)(j.a.mark((function e(t){var n,i,s,r,a,o,l,c,d,u,h,b,p,m,f;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i={},s=(null===(n=E)||void 0===n?void 0:n.forceUpgradeOwner)?"/api/activate-subscription":"/api/change-subscription",e.prev=2,e.next=5,F({uri:s,data:t,token:U});case 5:if(i=e.sent,d=(c=i).subscription,u=c.errors,h=c.user,b=c.meta,!u){e.next=9;break}return e.abrupt("return",{errors:u});case 9:return h=h||E.user,b&&(d.meta=Object.assign({},d.meta,b)),E=Object(v.a)(Object(v.a)({},E),{},{subscription:d,user:h,errors:u}),e.next=14,me({customerId:(null===d||void 0===d?void 0:d.customer_id)||(null===(r=h)||void 0===r?void 0:r.stripe_token)});case 14:return p=e.sent,m=D(E,p),E.currentPrice=Pe({stripePriceId:null===d||void 0===d||null===(a=d.meta)||void 0===a||null===(o=a.baseProduct)||void 0===o?void 0:o.stripe_price_id,availableProducts:E.availableProducts}),E.checkoutRoute=T(E),E=Object(v.a)(Object(v.a)({},E),m),(null===(l=E)||void 0===l?void 0:l.subscription)&&m&&(E.subscription.isActiveTrial=m.isTrial||(null===(f=E)||void 0===f?void 0:f.isIncomplete)),e.next=22,x.sendSubscriptionData(E);case 22:return e.abrupt("return",E);case 25:e.prev=25,e.t0=e.catch(2),i.errors={message:(null===e.t0||void 0===e.t0?void 0:e.t0.message)||"Error changing your subscription",originalError:e.t0};case 28:return e.abrupt("return",i);case 29:case"end":return e.stop()}}),e,null,[[2,25]])})))).apply(this,arguments)}function ye(e){return ke.apply(this,arguments)}function ke(){return(ke=Object(f.a)(j.a.mark((function e(t){var n;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={},e.prev=1,e.next=4,F({uri:"/api/cancel",data:t,token:U});case 4:return n=e.sent,e.abrupt("return",n);case 8:e.prev=8,e.t0=e.catch(1),n.errors={message:"Error cancelling subscription",originalError:e.t0};case 11:return e.abrupt("return",n);case 12:case"end":return e.stop()}}),e,null,[[1,8]])})))).apply(this,arguments)}function Se(e){return we.apply(this,arguments)}function we(){return(we=Object(f.a)(j.a.mark((function e(t){var n,i;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={},i=t.domain?"/api/update-domain-background":"/api/update-domain",e.prev=2,e.next=5,F({uri:i,data:t,token:U});case 5:n=e.sent,e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),n.errors={message:"Error updating custom domain",originalError:e.t0};case 11:return e.abrupt("return",n);case 12:case"end":return e.stop()}}),e,null,[[2,8]])})))).apply(this,arguments)}function Ne(e){return Ae.apply(this,arguments)}function Ae(){return(Ae=Object(f.a)(j.a.mark((function e(t){var n;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={},e.prev=1,e.next=4,F({uri:"/api/check-domain",data:t,headers:{"Content-Type":"application/json","Cache-Control":"private"},token:U});case 4:n=e.sent,e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),n.errors={message:"Error checking custom domain",originalError:e.t0};case 10:return e.abrupt("return",n);case 11:case"end":return e.stop()}}),e,null,[[1,7]])})))).apply(this,arguments)}function Ce(){return(Ce=Object(f.a)(j.a.mark((function e(){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.getToken();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Pe=function(e){var t=e.availableProducts,n=e.stripePriceId,i=n?function(e,t){var n=[];return e.forEach((function(e){e.prices.length&&e.prices.forEach((function(i){if(i.stripe_price_id.toString()===t.toString())return i.base_product=e.name,n.push(i)}))})),n}(t,n):[];return Object(g.a)(i,1)[0]},Me=n(165),_e=function(e){if(!e)throw new Error("No period string to format passed");return"".concat(e.charAt(0).toUpperCase()).concat(e.length>=2?e.slice(1):"","ly")},Ie=n(0),Te=function(e){Object(d.a)(n,e);var t=Object(u.a)(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"render",value:function(){var e,t,n,i,s,r=null,a=null,o=null,l=this.props,c=l.currentSiteLimits,d=l.currentPrice,u=l.subscription,b=l.currentSite,p=l.pendingSubscription,v=l.isPending,m=l.checkoutRoute,j=d.cost;(null===u||void 0===u||null===(e=u.meta)||void 0===e?void 0:e.addons)&&(null===u||void 0===u||null===(t=u.meta)||void 0===t?void 0:t.addons.length)?r=Object(Ie.jsxs)("div",{className:"plandetails-breakdown",children:[Object(Ie.jsx)("div",{className:"staticfield-label",children:"Price breakdown"}),Object(Ie.jsxs)("div",{className:"invoices-item",children:[Object(Ie.jsxs)("div",{className:"invoice-desc",children:[d.base_product," base plan"]}),Object(Ie.jsx)("div",{className:"invoice-price",children:N(d.cost,{symbol:"$"})})]}),null===u||void 0===u||null===(s=u.meta)||void 0===s?void 0:s.addons.map((function(e,t){var n=Object.assign({},e);return j+=n.cost,n.name.toLowerCase().indexOf("subdirectory")>=0&&(n.name="Subdirectory install"),Object(Ie.jsxs)("div",{className:"invoices-item",children:[Object(Ie.jsx)("div",{className:"invoice-desc",children:n.name}),Object(Ie.jsx)("div",{className:"invoice-price",children:N(n.cost,{symbol:"$"})})]},t)}))]}):(null===b||void 0===b?void 0:b.subdirectory)&&(r=Object(Ie.jsxs)("div",{className:"plandetails-breakdown",children:[Object(Ie.jsx)("div",{className:"staticfield-label",children:"Price breakdown"}),Object(Ie.jsxs)("div",{className:"invoices-item",children:[Object(Ie.jsxs)("div",{className:"invoice-desc",children:[d.base_product," base plan"]}),Object(Ie.jsx)("div",{className:"invoice-price",children:N(d.cost,{symbol:"$"})})]}),Object(Ie.jsx)("div",{className:"invoices-item",children:Object(Ie.jsx)("div",{className:"invoice-desc",children:"Subdirectory install (incl. in base plan)"})})]}));return(null===c||void 0===c||null===(n=c.staff)||void 0===n?void 0:n.exceeded)&&(a=Object(Ie.jsxs)("p",{className:"red",children:["Your plan includes ",null===c||void 0===c?void 0:c.staff.limit," staff users. You're currently using: ",null===c||void 0===c?void 0:c.staff.total,". ",Object(Ie.jsx)("a",{href:"https://ghost.org/help/views-and-staff-users/",children:"Plan limit details"})]})),v&&p&&p.product&&m&&(o=Object(Ie.jsxs)("p",{className:"red",children:["Your last plan change to ",Object(Ie.jsxs)("strong",{children:[p.product," (",_e(p.period),") isn't active"]})," yet. Click ",Object(Ie.jsx)(h.b,{to:m,children:Object(Ie.jsx)("strong",{children:"here"})})," to complete the payment now."]})),Object(Ie.jsx)(Ie.Fragment,{children:(null===d||void 0===d?void 0:d.base_product)?Object(Ie.jsxs)("div",{className:"box-plandetails box-wrap",children:[Object(Ie.jsx)("div",{className:"box-label",children:"Your plan details"}),Object(Ie.jsx)("div",{className:"box",children:Object(Ie.jsxs)("div",{className:"plandetails",children:[Object(Ie.jsxs)("div",{className:"plandetails-info",children:[Object(Ie.jsxs)("div",{className:"plandetails-content",children:[Object(Ie.jsxs)("h2",{children:[d.base_product," (",(null===d||void 0===d?void 0:d.billing_period)&&_e(d.billing_period),")"]}),(null===d||void 0===d?void 0:d.features)&&Object(Ie.jsxs)("p",{children:["Base plan with ",null===d||void 0===d||null===(i=d.features)||void 0===i?void 0:i.filter((function(e){return e.indexOf("Everything")<0})).join(", ").toLowerCase()]})]}),Object(Ie.jsx)("div",{children:Object(Ie.jsx)(h.b,{className:"gh-btn gh-btn-green plandetails-cta",to:"/plans",disabled:this.props.isGrace,children:"Update plan \u2192"})})]}),(o||a)&&Object(Ie.jsxs)("div",{className:"plandetails-warning",children:[o,a]}),r,Object(Ie.jsxs)("footer",{children:[Object(Ie.jsxs)("strong",{children:["Total price per ",null===d||void 0===d?void 0:d.billing_period]}),Object(Ie.jsx)("strong",{children:j&&N(j,{symbol:"$"})})]})]})})]}):null})}}]),n}(s.a.Component),De=(n(308),n(155)),Ee=function(e){var t=Object(i.useState)(!1),n=Object(g.a)(t,2),r=n[0],a=n[1],o=Object(i.useState)(!1),l=Object(g.a)(o,2),c=l[0],d=l[1],u=function(){(null===e||void 0===e?void 0:e.closeModal)&&"function"===typeof e.closeModal&&e.closeModal(),r&&(a(!1),d(!1))},h=s.a.useRef(null),b=Object(Ie.jsx)("svg",{version:"1",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:Object(Ie.jsx)("path",{d:"M12.707 12L23.854.854a.5.5 0 0 0-.707-.707L12 11.293.854.146a.5.5 0 0 0-.707.707L11.293 12 .146 23.146a.5.5 0 0 0 .708.708L12 12.707l11.146 11.146a.5.5 0 1 0 .708-.706L12.707 12z"})}),p=null;return e.openModalTrigger&&(s.a.isValidElement(e.openModalTrigger)?p=s.a.cloneElement(e.openModalTrigger,{onClick:function(){(null===e||void 0===e?void 0:e.openModal)&&"function"===typeof e.openModal&&e.openModal(),r||(a(!0),d(!1))}}):r||c||(d(!0),a(!0))),e.closeModal&&r&&!c&&(d(!0),u()),Object(Ie.jsxs)(Ie.Fragment,{children:[Object(Ie.jsx)("div",{ref:h,className:"gh-modal-content"}),p,Object(Ie.jsx)(De.a,Object(v.a)(Object(v.a)({open:r,onClose:u,"aria-labelledby":e.title,center:!0,focusTrapped:!1,closeIcon:b,container:h.current,classNames:{overlay:"gh-modal-overlay",modal:"gh-modal",closeButton:"gh-modal-close"}},e),{},{children:e.children}))]})};function Ue(e,t){var n="pending"===(null===e||void 0===e?void 0:e.status)?"<strong>Pending</strong>":"Paid",i=new Date(e.date).toLocaleString("en-UK",{year:"numeric",month:"short",day:"numeric"});return Object(Ie.jsxs)("a",{className:"invoices-item",href:e.url,target:"_blank",rel:"noopener noreferrer",children:[Object(Ie.jsxs)("div",{className:"invoice-desc",children:[i," \u2014 ",n]}),Object(Ie.jsxs)("div",{className:"invoice-price",children:[Object(Ie.jsx)("div",{className:"invoice-amount",children:N(e.paid,{symbol:"$"})}),Object(Ie.jsx)("div",{className:"invoice-arrow",children:"\u2192"})]})]},t)}var Le=function(e){Object(d.a)(n,e);var t=Object(u.a)(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"render",value:function(){var e=this.props.invoices.slice(0,5).map(Ue),t=this.props.invoices.map(Ue);return Object(Ie.jsxs)("div",{className:"box-invoices box-wrap",children:[Object(Ie.jsx)("div",{className:"box-label",children:"Billing history"}),Object(Ie.jsx)("div",{className:"box",children:Object(Ie.jsxs)("section",{className:"staticfield",children:[Object(Ie.jsxs)("header",{children:[Object(Ie.jsx)("div",{className:"staticfield-label",children:"Invoices"}),this.props.invoices.length>=5&&Object(Ie.jsxs)(Ee,{title:"All invoices",openModalTrigger:Object(Ie.jsx)("button",{className:"staticfield-link",children:"View all"}),children:[Object(Ie.jsx)("header",{children:Object(Ie.jsx)("h1",{children:"Invoices."})}),t]})]}),Object(Ie.jsx)("div",{className:"invoices",children:e})]})})]})}}]),n}(s.a.Component),Be=n(56),Fe=n(79),Re="gh-btn gh-btn-block spinner",Ge="Submit",Ve=!1;function He(e){var t,n,s,r=function(){};e.onSubmit&&"function"===typeof e.onSubmit&&(r=e.onSubmit);var a=Object(i.useState)(null!==(t=e.className)&&void 0!==t?t:Re),o=Object(g.a)(a,2),l=o[0],c=o[1],d=Object(i.useState)(null!==(n=e.html)&&void 0!==n?n:Ge),u=Object(g.a)(d,2),h=u[0],b=u[1],p=Object(i.useState)(null!==(s=e.disabled)&&void 0!==s?s:Ve),v=Object(g.a)(p,2),m=v[0],j=v[1];return Object(i.useEffect)((function(){var t,n,i;c(null!==(t=e.className)&&void 0!==t?t:Re),b(null!==(n=e.html)&&void 0!==n?n:Ge),j(null!==(i=e.disabled)&&void 0!==i?i:Ve)}),[e]),Object(Ie.jsx)("button",{className:l,disabled:m,onClick:function(e){return r(e)},dangerouslySetInnerHTML:{__html:h}})}var We=Object(Fe.a)("pk_live_XsbJ2DC9W2rf9cCj7ELbelvq"),ze=[{family:"Inter",weight:400,src:'local("Inter var"), local("Inter"), url(/assets/fonts/Inter-roman.var.woff2) format("woff2")'}],Ke={style:{base:{color:"#15171A",fontWeight:"400",fontFamily:"Inter, sans-serif",fontSize:"15px",fontSmoothing:"antialiased",textShadow:"#000000","::placeholder":{color:"#a9b6bc"},":focus::placeholder":{color:"#a9b6bc"},":-webkit-autofill":{color:"#687e87",fontWeight:"400",fontFamily:"Inter, sans-serif",fontSize:"15px",fontSmoothing:"antialiased",textShadow:"#000000"}},invalid:{color:"#687e87"}},classes:{invalid:"error",complete:"complete",empty:"empty",focus:"focus",webkitAutofill:"autofill"}};function qe(e){var t=e.disabled;return Object(Ie.jsxs)(Ie.Fragment,{children:[Object(Ie.jsx)("header",{children:Object(Ie.jsx)("h1",{children:"Update your card details."})}),Object(Ie.jsxs)("div",{className:"gh-input-group",children:[Object(Ie.jsx)("label",{htmlFor:"signup-name",children:"Full name"}),Object(Ie.jsx)("input",{id:"signup-name",className:"gh-input",type:"text",required:!0,name:"name",placeholder:"Jamie Larson",autoCorrect:"off",autoFocus:!0,disabled:t})]}),Object(Ie.jsxs)("div",{className:"gh-input-group",children:[Object(Ie.jsx)("label",{htmlFor:"signup-form-cc",children:"Credit or debit card"}),Object(Ie.jsx)(Be.CardElement,{className:"gh-input",options:Ke})]})]})}function Ye(e){var t={className:"gh-btn gh-btn-block",html:"Done",type:"submit",disabled:!0},n={className:"gh-btn gh-btn-block gh-btn-red",html:"Try again",type:"submit",disabled:!1},s={className:"gh-btn gh-btn-block spinner",html:'<span><div class="gh-spinner"></div></span>',disabled:!0},r={className:"gh-btn gh-btn-block",html:"Update",type:"submit",disabled:!1},a=Object(Be.useStripe)(),o=Object(Be.useElements)(),l=Object(i.useState)(null),c=Object(g.a)(l,2),d=c[0],u=c[1],h=Object(i.useState)(Object(v.a)({},r)),b=Object(g.a)(h,2),p=b[0],m=b[1],x=function(e){return u(e)},O=function(){var i=Object(f.a)(j.a.mark((function i(l){var c,d,u,h,b,p;return j.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(l.preventDefault(),m(Object(v.a)({},s)),x(null),a&&o){i.next=5;break}return i.abrupt("return",m(Object(v.a)(Object(v.a)({},r),{},{disabled:!0})));case 5:return i.next=7,le(e.customerId);case 7:if(c=i.sent,d=c.clientSecret,u=c.setupIntentId,(h=c.errors)||!d){i.next=23;break}return i.next=14,a.confirmCardSetup(d,{payment_method:{card:o.getElement(Be.CardElement)}});case 14:if(!(b=i.sent).error){i.next=20;break}return x((null===(p=b.error)||void 0===p?void 0:p.message)||"Error updating your card. Please try again or contact support@ghost.org if the error persists."),i.abrupt("return",m(Object(v.a)({},n)));case 20:return i.abrupt("return",he({userId:e.userId,customerId:e.customerId,setupIntentId:u}).then((function(i){return i.errors?(x("Error updating your card. Please try again or contact support@ghost.org if the error persists."),m(Object(v.a)({},n))):(m(Object(v.a)({},t)),e.closeModal({reload:!1}))})));case 21:i.next=25;break;case 23:return x((null===h||void 0===h?void 0:h.message)||"Error updating your card. Please try again or contact support@ghost.org if the error persists."),i.abrupt("return",m(Object(v.a)({},n)));case 25:case"end":return i.stop()}}),i)})));return function(e){return i.apply(this,arguments)}}();return Object(Ie.jsxs)("form",{className:"gh-form",onSubmit:O,children:[Object(Ie.jsx)(qe,{disabled:p.disabled}),Object(Ie.jsx)(He,Object(v.a)({},p)),d&&Object(Ie.jsx)("div",{className:"form-error",children:Object(Ie.jsx)("p",{className:"error-msg",children:d})})]})}function Ze(e){return Object(Ie.jsx)(Be.Elements,{stripe:We,fonts:ze,children:Object(Ie.jsx)(Ye,Object(v.a)({},e))})}function Je(e){var t=e.user,n=null,i={visa:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACMAAAALCAYAAAD1JjQCAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAMPSURBVHgBZVRdSFRBFD5zd/1BSbYekohKxUX706LyJSStKBB60MxVM3I309DAB4l6CR9ECAIlH4qCdjfzwXV9UQg0erAsQrLSWDRF1IgiBUVJzdzdGc+dmb2zl53lznxzfr7znTuzl2x1pboosTg0AhdADsqgI/Hq78bIHiq9eRBmIxwzeAc91QXg8K7gLgWfafA5s0Sc5xiESRswVgAEfyKB4lQCPlefwVfmeYJznYhhU+jL1s1afNWCGwtfpBrJml3ftcqNBG6z/j1JRjKl9QYG5gZHV44UAkg3y9fL3sNA4SP6C5UQHqABIavGVo8jcEvFkEy41pnM60ZiEst/TWe/afraMnVO2DdohhJDzkv0E3pcLwDCqcoHAb5aWAe+tUShl7RjqXREebhxAUkIGPFx9A6YhwU2Qyd1YDWZGQy1fD9bYLNuQkPGe11VAMrcFUi8V0YMijiK3UWaZ+OiQZKuEwiB4QHouTGPSH8+GfyVXQcgFCwR74QNY1K+yGXHcX6rmcVor/WlKVAEr/4cOiKLlBp+Aq1i1Y6qJDIjctkH1as2iE14odyTZuKnQf0Id4hNqAanFcmXqy9mMTs3RyMBtWPFuZKsRHqHoNs5LzvJVA1siCNg4UYUNKM0kuv4osahwn1GxUKzdE6Cr3YaDROyydOxYp7VBXEe0OHSVrIdk4uivI+jSCNvZgn8DWsc+WuW8T7ZkdgJ4nj0kYL3rZOjK95inNOEmbZJUV8knx2qPTazGO6gIxLZ8GmVeB581b0clbv3SZ8+Psfkdzu9kJSsX9yQtOwXdVmlCiIPweGZQ1BlmNbICWsMWQLtgy2tPUoQL6GzcRS22kELSzMNSIHP8Ts0DHGWCfxILcL6ugOPSXKzSX7cDEqjqtiiuKU+Whgr5uXNOUxexOTdKhCeKhzMMU6XkR9yzcePkwsFReLVYFoLTveiLI/QP6b80M6FaeRgrBjeMO3FG14vsR/8/G8qC5E0A2vkm2RcNivgYwhFNoPt/yisxj+QtgX4t3gf+u/+NaIcbvyDkEuITm0DyLgGA4psvAkAAAAASUVORK5CYII=",mastercard:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACMAAAAYCAMAAABHurQFAAAAt1BMVEUAAAD2kRv3nhvrABv3nhv3nhvrABvrABvrABvrABv3nhv3nhvrABvrABvrABv3nhvrABv3nhvrABv3nhvrABv3nhv3nhvrABvrABv3nhv3nhv3nhv3nhvrABv3nhv3nhv3nhv3nhvrABvrABvrABv3Uw/3Uw/3nhvrABvrABv3nhvrABv/XwD5kRXvEBbvExXyHxLzJRH6hBD2Mg37egv9agX+YwL+WAL+WwH6iBH6hxH7TAX7SwXuCeiKAAAAKnRSTlMABeLh+NUI6dZyaA7488vDvq2nhIB5bmdcHe3r59rKyJ6YmJBsaGRiGhlVv2rZAAAAsUlEQVQoz83S1xKCMBAFUDaRqmLH3jss9q7//10qTJYyzDC8cZ/PJNnclfIapalxzs2FIoExZozJjWJMQFt1/Ggr2fbTNyBC5o7IAZ+2yDSMOiVBdne8ucIU1gHZlumYDyJebUJdMjqR/QN/cQm1yNTJHPGfE5kamSqZs2cuZCoZTMpdGd68CWZ/x2ZP/0Mj1BnMQl286JgJQGKnw6XotGdBwm6o3NQVCawRG3i7kdN8AchvOWZDiGTOAAAAAElFTkSuQmCC",americanexpress:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACMAAAAWCAMAAAB9sNV1AAAAilBMVEUAcc4WftIbgNMIdtBdpeAOedGKvukEc8/////a6/ju9fyjzO73+/6dyexDltvf7flKmtwpiNbi7/nE3vT9/v/r9PvL4vW42PL5/P7z+P3Q5fbO5Pa+2/Oz1fCt0e95tOVtruNiqOFZo99BlduYxeshhNXm8frU5/aBueeAuOeAueZOnN02j9gzjdjPp01hAAAA9ElEQVQoz53QyW7DMAxF0RcxlGTLkmc78Twknfv/v1fDQDeFDAO9C3JzwAVhCSdNEDjtv+YaRVGj4m2G1EZZ7DEUCKB2LwwVfFT+O0sOxpqFDEzFu990n+gFhZovSpWCyGO+KqhwxKo5nXGFEx5Tz/tSGaeZAgKPoZjZWuvwxulN4DvyGGvcpLVuXZLMWrrHbXF/DRljimAvDuJC6zjIfD8MsSehKl0D/YEZ8jy/GdDIqh8PzJokyV0bBTJSHZhnmqZ33TA47/jANGVZFhWQKHo1B4a2asJwl6DWZyK595BmuFgrvXeuvy0E3haeOIvQictJ8gcsfw2dmkWFtwAAAABJRU5ErkJggg=="};if(null===t||void 0===t?void 0:t.cardType){var s=i[(null===t||void 0===t?void 0:t.cardType)&&(null===t||void 0===t?void 0:t.cardType.trim().toLowerCase().replace(/\s+/gim,""))],r="".concat(t.cardExpiry.substr(5,2),"/").concat(t.cardExpiry.substr(2,2));n=Object(Ie.jsx)("div",{className:"staticfield-card",children:Object(Ie.jsxs)("div",{className:"staticfield-card",children:[Object(Ie.jsxs)("div",{className:"staticfield-cardnumber",children:[Object(Ie.jsx)("img",{src:s,alt:t.cardType})," \u2022\u2022\u2022\u2022 \u2022\u2022\u2022\u2022 \u2022\u2022\u2022\u2022 ",t.cardLast4]}),Object(Ie.jsxs)("div",{className:"staticfield-value",children:["Expires ",r]})]})})}else n=Object(Ie.jsx)("div",{className:"staticfield-card",children:Object(Ie.jsx)("div",{className:"staticfield-card",children:Object(Ie.jsx)("p",{children:"No credit card"})})});return n}var Qe=function(e){Object(d.a)(n,e);var t=Object(u.a)(n);function n(e){var i;return Object(o.a)(this,n),(i=t.call(this,e)).state={closeModal:!1,disableCancel:!0,cancelToggle:{download:!1,deleted:!1,recover:!1}},i.cancelAccount=i.handleCancelAccount.bind(Object(c.a)(i)),i.handleCancelToggle=i.handleCancelToggle.bind(Object(c.a)(i)),i}return Object(l.a)(n,[{key:"handleCancelToggle",value:function(e,t){var n=this.state.cancelToggle;n[t]=e.target.checked,this.setState({toggle:n});var i=Object.values(n);i.length>=3&&i.every((function(e){return!0===e}))?this.setState({disableCancel:!1}):this.setState({disableCancel:!0})}},{key:"handleCancelAccount",value:function(){var e=Object(f.a)(j.a.mark((function e(t){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),this.props.setLoadingState(!0),e.next=4,ye({subscriptionId:this.props.subscription.id});case 4:if(!e.sent.errors){e.next=7;break}return e.abrupt("return",this.setState({errors:{cancel:"Something went wrong trying to cancel. Please contact support@ghost.org"}}));case 7:return this.props.closeModal({reload:!0}),e.abrupt("return",window.parent.location.href="https://ghost.org");case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e,t,n=this;return Object(Ie.jsx)(Ee,{openModal:this.state.openModal,closeModal:this.state.closeModal,title:"Cancel account",openModalTrigger:Object(Ie.jsx)("button",{className:"red",children:"Cancel account"}),children:Object(Ie.jsx)("div",{children:Object(Ie.jsxs)("form",{className:"gh-form cancel-account",onSubmit:this.cancelAccount,children:[Object(Ie.jsx)("header",{children:Object(Ie.jsx)("h1",{children:"Cancel & delete account"})}),Object(Ie.jsxs)("div",{className:"cancel-account-warning",children:[Object(Ie.jsx)("p",{children:"Here's what happens when you cancel:"}),Object(Ie.jsxs)("ul",{children:[Object(Ie.jsx)("li",{children:"Your subscription will stop and you won\u2019t be billed again."}),Object(Ie.jsx)("li",{children:"Your Ghost(Pro) account will be closed immediately."}),Object(Ie.jsx)("li",{children:"Your account and publication data will be permanently deleted. Remember to export your data before you cancel."})]})]}),Object(Ie.jsxs)("div",{className:"gh-input-group",children:[Object(Ie.jsxs)("span",{className:"toggle-inline",children:[Object(Ie.jsx)("input",{id:"checkbox-download",className:"toggle-btn",type:"checkbox",name:"download",disabled:this.props.disableSubmit,onChange:function(e){return n.handleCancelToggle(e,"download")}}),Object(Ie.jsx)("label",{htmlFor:"download",children:"I have downloaded my data / don\u2019t need my data"})]}),Object(Ie.jsxs)("span",{className:"toggle-inline",children:[Object(Ie.jsx)("input",{id:"checkbox-deleted",className:"toggle-btn",type:"checkbox",name:"deleted",disabled:this.props.disableSubmit,onChange:function(e){return n.handleCancelToggle(e,"deleted")}}),Object(Ie.jsx)("label",{htmlFor:"deleted",children:"I understand that my data will be permanently deleted"})]}),Object(Ie.jsxs)("span",{className:"toggle-inline",children:[Object(Ie.jsx)("input",{id:"checkbox-recover",className:"toggle-btn",type:"checkbox",name:"recover",disabled:this.props.disableSubmit,onChange:function(e){return n.handleCancelToggle(e,"recover")}}),Object(Ie.jsx)("label",{htmlFor:"recover",children:"I understand that my data cannot be recovered"})]})]}),Object(Ie.jsx)("button",{className:"gh-btn gh-btn-block gh-btn-red",disabled:this.state.disableCancel,type:"submit",children:"Cancel subscription and delete all data"}),(null===(e=this.state)||void 0===e||null===(t=e.errors)||void 0===t?void 0:t.cancel)&&Object(Ie.jsx)("div",{className:"form-error",children:Object(Ie.jsx)("p",{className:"error-msg",children:this.state.errors.cancel})})]})})})}}]),n}(s.a.Component);function Xe(e){var t={className:"gh-btn gh-btn-block",html:"Done",type:"submit",disabled:!0},n={className:"gh-btn gh-btn-block gh-btn-red",html:"Try again",type:"submit",disabled:!1},s={className:"gh-btn gh-btn-block spinner",html:'<span><div class="gh-spinner"></div></span>',disabled:!0},r={className:"gh-btn gh-btn-block",html:"Update",type:"submit",disabled:!1},a=Object(i.useState)(e.invoiceDetails),o=Object(g.a)(a,2),l=o[0],c=o[1],d=Object(i.useState)(null),u=Object(g.a)(d,2),h=u[0],b=u[1],p=Object(i.useState)(Object(v.a)({},r)),m=Object(g.a)(p,2),x=m[0],O=m[1],y=function(){var i=Object(f.a)(j.a.mark((function i(r){var a,o;return j.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return r.preventDefault(),O(Object(v.a)({},s)),b(null),i.next=5,pe({customerId:e.customerId,invoiceDetails:l});case 5:if(!(a=i.sent).errors){i.next=10;break}return o=a.errors.message,b(o),i.abrupt("return",O(Object(v.a)({},n)));case 10:return i.next=12,W("invoiceDetails");case 12:return O(Object(v.a)({},t)),i.abrupt("return",e.closeModal({reload:!1}));case 14:case"end":return i.stop()}}),i)})));return function(e){return i.apply(this,arguments)}}();return Object(Ie.jsxs)("form",{className:"gh-form",onSubmit:y,children:[Object(Ie.jsx)("header",{children:Object(Ie.jsx)("h1",{children:"Update your invoice details."})}),Object(Ie.jsxs)("div",{className:"gh-input-group",children:[Object(Ie.jsx)("label",{htmlFor:"invoice-details",children:"Billing info"}),Object(Ie.jsx)("textarea",{id:"invoice-details",className:"gh-input",name:"name",placeholder:"Enter optional address or billing information to be displayed on invoices.",rows:"5",autoCorrect:"off","data-testid":"input-invoice-details",autoFocus:!0,value:l,onChange:function(e){return function(e){c(e.target.value),b(null),O(Object(v.a)({},r))}(e)}})]}),Object(Ie.jsx)(He,Object(v.a)({},x)),h&&Object(Ie.jsx)("div",{className:"form-error",children:Object(Ie.jsx)("p",{className:"error-msg",children:h})})]})}var $e=function(e){Object(d.a)(n,e);var t=Object(u.a)(n);function n(e){var i;return Object(o.a)(this,n),(i=t.call(this,e))._verbose=!1,i._isMounted=!1,i.buttonStates={success:{className:"gh-btn gh-btn-block",html:"Done",type:"submit",disabled:!0},fail:{className:"gh-btn gh-btn-block gh-btn-red",html:"Try again",type:"submit",disabled:!1},pending:{className:"gh-btn gh-btn-block spinner",html:'<span><div class="gh-spinner"></div></span>',disabled:!0},default:{className:"gh-btn gh-btn-block",html:"Update",type:"submit",disabled:!1}},e&&e.showNav&&e.showNav(!1),i.state={loading:!0,closeModal:!0},i.handleOpenModal=i.handleOpenModal.bind(Object(c.a)(i)),i.handleCloseModal=i.handleCloseModal.bind(Object(c.a)(i)),i.handleNestedLoadingState=i.handleNestedLoadingState.bind(Object(c.a)(i)),i.handleCloseNoSubmit=i.handleCloseNoSubmit.bind(Object(c.a)(i)),i.handleCloseModalAndContactSupport=i.handleCloseModalAndContactSupport.bind(Object(c.a)(i)),i}return Object(l.a)(n,[{key:"handleCloseNoSubmit",value:function(){var e=Object(f.a)(j.a.mark((function e(){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({showCardUpdateModal:!1}),e.next=3,this.handleCloseModal({reload:!1});case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"handleOpenModal",value:function(){this.setState({closeModal:!1,buttonState:this.buttonStates.default})}},{key:"handleCloseModal",value:function(){var e=Object(f.a)(j.a.mark((function e(t){var n,i,s,r,a,o=this;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.reload,i=t.delay,!n||!0!==n){e.next=15;break}if(this.props.showNav(!1),this.setState({closeModal:!0,loading:!0,showCardUpdateModal:!1,errors:null,buttonState:this.buttonStates.pending}),!i){e.next=8;break}return e.abrupt("return",setTimeout(Object(f.a)(j.a.mark((function e(){var t,n;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,X({updateAdmin:!0});case 2:n=e.sent,o.setState(Object(v.a)(Object(v.a)({},n),{},{loading:!1,buttonState:Object(v.a)(Object(v.a)({},o.buttonStates.default),{},{disabled:!(null===n||void 0===n||null===(t=n.user)||void 0===t?void 0:t.cardType)})})),o.props.showNav(!0);case 5:case"end":return e.stop()}}),e)}))),i));case 8:return e.next=10,X();case 10:r=e.sent,this.setState(Object(v.a)(Object(v.a)({},r),{},{loading:!1,buttonState:Object(v.a)(Object(v.a)({},this.buttonStates.default),{},{disabled:!(null===r||void 0===r||null===(s=r.user)||void 0===s?void 0:s.cardType)})})),this.props.showNav(!0);case 13:e.next=20;break;case 15:return e.next=17,Y();case 17:a=e.sent,this.setState(Object(v.a)(Object(v.a)({},a),{},{_invoiceDetails:a.invoiceDetails,closeModal:!0,showCardUpdateModal:!1,buttonState:this.buttonStates.default})),this.props.showNav(!0);case 20:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"handleNestedLoadingState",value:function(e){this.setState({loading:e}),this.props.showNav(!e)}},{key:"handleCloseModalAndContactSupport",value:function(e){return e.preventDefault(),this.setState({closeModal:!0}),window.location.href="mailto:support@ghost.org"}},{key:"componentDidMount",value:function(){var e=Object(f.a)(j.a.mark((function e(){var t,n,i,s,r,a;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._isMounted=!0,e.next=3,Y();case 3:if(t=e.sent,Me.b((function(e){var n,i,s,r;e.setTransactionName("Dashboard"),e.setUser({email:null===t||void 0===t||null===(n=t.user)||void 0===n?void 0:n.email_address}),e.setContext("billingData",{status:null===t||void 0===t||null===(i=t.subscription)||void 0===i?void 0:i.status,price:null===t||void 0===t||null===(s=t.currentPrice)||void 0===s?void 0:s.nickname,site:null===t||void 0===t||null===(r=t.currentSite)||void 0===r?void 0:r.url,exceededLimits:null===t||void 0===t?void 0:t.exceededLimits,forceUpgrade:null===t||void 0===t?void 0:t.isForceUpgrade,errors:null===t||void 0===t?void 0:t.errors}),e.setTag("section","dashboard")})),!this._isMounted){e.next=22;break}if(!(null===t||void 0===t?void 0:t.forceUpgradeOwner)){e.next=19;break}if("active"!==(null===t||void 0===t||null===(i=t.subscription)||void 0===i?void 0:i.status)){e.next=16;break}return this._verbose&&console.log("[BMA] Site in forceUpgrade state but with active subscription"),e.next=11,V();case 11:s=e.sent,r=s.forceUpgradeOwner,this._verbose&&console.log("[BMA] Updated forceUpgrade info:",r),e.next=17;break;case 16:return e.abrupt("return",this.props.history.push("/plans"));case 17:e.next=21;break;case 19:if(!t.isIncomplete){e.next=21;break}return e.abrupt("return",this.props.history.push(t.checkoutRoute));case 21:this.setState(Object(v.a)(Object(v.a)({},t),{},{loading:!1,noCurrentPrice:!(null===t||void 0===t||null===(n=t.currentPrice)||void 0===n?void 0:n.stripe_price_id),showCardUpdateModal:(null===t||void 0===t?void 0:t.isGrace)||!1,buttonState:this.buttonStates.default,_invoiceDetails:null===t||void 0===t?void 0:t.invoiceDetails}));case 22:this.props&&"function"===typeof this.props.showNav&&((null===t||void 0===t?void 0:t.errors)||(null===t||void 0===t?void 0:t.isInactive)||(null===(a=this.state)||void 0===a?void 0:a.noCurrentPrice)?this.props.showNav(!1):this.props.showNav(!0));case 23:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){this._isMounted=!1,this.state.isGrace&&this.setState({showCardUpdateModal:!0})}},{key:"render",value:function(){var e,t,n,i,s,r,a,o,l,c,d,u,h,b,m,j,f,g,x,O=this,y=null,k=null,S=null,w=!1;if(403===(null===(e=this.state)||void 0===e||null===(t=e.errors)||void 0===t?void 0:t.status)||(null===(n=this.state)||void 0===n?void 0:n.forceUpgradeNoOwner)||(null===(i=this.state)||void 0===i?void 0:i.isInactive)||this.state.noCurrentPrice)if(w=!0,403===(null===(g=this.state)||void 0===g||null===(x=g.errors)||void 0===x?void 0:x.status))S=Object(Ie.jsxs)(Ie.Fragment,{children:["You\u2019re on a special legacy plan, if you need to make any billing changes please reach out to us on ",Object(Ie.jsx)("a",{href:"mailto:support@ghost.org",onClick:this.handleCloseModalAndContactSupport,children:"support@ghost.org"})]});else if(this.state.forceUpgradeNoOwner){var N,A,C,P,M,_,I=(null===(N=this.state)||void 0===N||null===(A=N.siteOwner)||void 0===A?void 0:A.name)?"".concat(null===(C=this.state)||void 0===C||null===(P=C.siteOwner)||void 0===P?void 0:P.name," | ").concat(null===(M=this.state)||void 0===M||null===(_=M.siteOwner)||void 0===_?void 0:_.email):"the owner of the publication";S=Object(Ie.jsxs)(Ie.Fragment,{children:["Your trial is over, please ask ",I," to choose a plan."]})}else S=Object(Ie.jsxs)(Ie.Fragment,{children:["Please contact ",Object(Ie.jsx)("a",{href:"mailto:support@ghost.org",onClick:this.handleCloseModalAndContactSupport,children:"support@ghost.org"})," for changes to your billing."]});else w=!1;return(this.state.isActive||this.state.isGrace)&&(k=Object(Ie.jsx)(Qe,Object(v.a)(Object(v.a)({},this.state),{},{setLoadingState:this.handleNestedLoadingState,closeModal:this.handleCloseModal}))),this.state.isTrial&&!(null===(s=this.state)||void 0===s?void 0:s.errors)?Object(Ie.jsx)(p.a,{to:"/plans"}):(m=Object(Ie.jsx)(Te,Object(v.a)({},this.state)),f=Object(Ie.jsx)(Ie.Fragment,{children:this.state.showCardUpdateModal?Object(Ie.jsx)(Ee,{openModalTrigger:this.state.showCardUpdateModal,closeModal:this.handleCloseNoSubmit,title:"Update credit card",children:Object(Ie.jsx)(Ze,{setLoadingState:this.handleNestedLoadingState,closeModal:function(){return O.handleCloseModal({reload:!0,delay:5e3})},userId:null===(r=this.state.user)||void 0===r?void 0:r.id,customerId:null===(a=this.state.subscription)||void 0===a?void 0:a.customer_id})}):Object(Ie.jsx)(Ee,{openModal:this.handleOpenModal,closeModal:this.state.closeModal,title:"Update credit card",openModalTrigger:Object(Ie.jsx)("button",{className:"staticfield-link",children:this.state.isGrace?"Update":"Edit"}),children:Object(Ie.jsx)(Ze,{setLoadingState:this.handleNestedLoadingState,closeModal:this.state.isGrace?function(){return O.handleCloseModal({reload:!0,delay:5e3})}:this.handleCloseModal,userId:null===(o=this.state.user)||void 0===o?void 0:o.id,customerId:null===(l=this.state.subscription)||void 0===l?void 0:l.customer_id})})}),j=Object(Ie.jsxs)("div",{className:"box-carddetails box-wrap",children:[Object(Ie.jsx)("div",{className:"box-label",children:"Payment information"}),Object(Ie.jsxs)("div",{className:"box",children:[Object(Ie.jsxs)("section",{className:"staticfield",children:[Object(Ie.jsxs)("header",{children:[Object(Ie.jsx)("div",{className:"staticfield-label",children:"Credit card"}),f]}),Object(Ie.jsx)(Je,{user:this.state.user})]}),Object(Ie.jsxs)("section",{className:"staticfield",children:[Object(Ie.jsxs)("header",{children:[Object(Ie.jsx)("div",{className:"staticfield-label",children:"Invoice details"}),Object(Ie.jsx)(Ee,{openModal:this.handleOpenModal,closeModal:this.state.closeModal,title:"Update invoice details",openModalTrigger:Object(Ie.jsx)("button",{className:"staticfield-link",children:"Edit"}),children:Object(Ie.jsx)(Xe,{closeModal:this.handleCloseModal,invoiceDetails:null===(c=this.state)||void 0===c?void 0:c.invoiceDetails,customerId:null===(d=this.state.subscription)||void 0===d?void 0:d.customer_id})})]}),Object(Ie.jsx)("div",{className:"staticfield-value",dangerouslySetInnerHTML:{__html:(null===(u=this.state)||void 0===u?void 0:u._invoiceDetails)||"<span>Add optional address / billing info</span>"}})]})]})]}),(null===(h=this.state)||void 0===h?void 0:h.invoices)&&(y=Object(Ie.jsx)(Le,{invoices:this.state.invoices})),Object(Ie.jsx)("main",{className:"main",children:(null===(b=this.state)||void 0===b?void 0:b.loading)?Object(Ie.jsx)("div",{className:"gh-loading-content",children:Object(Ie.jsx)("div",{className:"gh-loading-spinner"})}):w?Object(Ie.jsx)("p",{style:{textAlign:"center",gridColumn:"1 / 3"},children:S}):Object(Ie.jsxs)("div",{className:"accountgrid","data-test-id":"dashboard",children:[m,j,y,Object(Ie.jsxs)("footer",{className:"footer",children:[k,Object(Ie.jsx)("a",{href:"https://ghost.org/help/manage-your-subscription/",target:"_blank",rel:"noopener noreferrer",children:"Billing Help"})]})]})}))}}]),n}(s.a.Component),et=Object(p.g)($e),tt=n(342),nt=function(e,t){return parseInt(e,10)*("month"===t?12:1)},it=function(e,t){return parseInt(e,10)/("year"===t?12:1)},st=n(158),rt=n.n(st),at=[500,1e3,3e3,5e3,8e3,1e4,15e3,2e4,25e3,35e3,45e3,55e3,65e3,75e3,85e3,95e3,105e3,115e3,125e3,135e3,145e3,155e3,165e3,175e3,185e3,195e3,205e3,215e3,225e3,235e3,245e3,265e3,285e3,305e3,325e3,345e3,365e3,385e3,4e5],ot=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=at.filter((function(t){return t>=e})).sort((function(e,t){return e-t}))[0];return!t&&e>at[at.length-1]?at[at.length-1]:t},lt=function(e,t,n){if(!e||!e.length||!t||!n)throw new Error("Arguments must be provided");return e.sort((function(e,t){var n=e.limits,i=t.limits,s=n.filter((function(e){return"members"===e.name})),r=Object(g.a)(s,1)[0],a=i.filter((function(e){return"members"===e.name})),o=Object(g.a)(a,1)[0];return r.value-o.value})).filter((function(e){var i=e.billing_period===n,s=e.limits.filter((function(e){return"members"===e.name&&e.value>=t}));return i&&s.length}))},ct=function(e,t,n){var i=[];return e.forEach((function(e){if(t[e.name]){var s=t[e.name];switch(null===e||void 0===e?void 0:e.name){case"staff":i.push({limit:e.name,valid:"business"===n.toLowerCase()||s.total<=e.value,message:"business"===n.toLowerCase()?null:s.total>e.value?"Not available with more than ".concat(N(e.value)," staff ").concat(e.value>1?"users":"user"):null});break;case"newsletters":i.push({limit:e.name,valid:s.total<=e.value,message:s.total>e.value?1===e.value?"Not available with multiple newsletters":"Not available with more than ".concat(N(e.value)," ").concat(e.value>1?"newsletters":"newsletter"):null});break;case"customThemes":i.push({limit:e.name,valid:e.value.toLowerCase().indexOf("official")>=0&&s.hasOfficialTheme,message:e.value.toLowerCase().indexOf("official")>=0&&!s.hasOfficialTheme?"Not available when using custom theme":null});break;case"customIntegrations":i.push({limit:e.name,valid:!0});break;case"members":i.push({limit:e.name,valid:s.total<=e.value,message:s.total>e.value?"Not available with more than ".concat(N(e.value)," members"):null})}}})),i},dt=function(e,t){var n=t.productLimits,i=t.currentSiteLimits,s=t.product,r=(t.verbose,[]),a=[];if(!i)throw new Error("currentSiteLimits missing");return n&&n.length&&(r=ct(n,i,s)),e&&e.limits&&e.limits.length&&(a=ct(e.limits,i)),r.concat(a).filter((function(e){return!1===e.valid&&e.message}))},ut=function(e){Object(d.a)(n,e);var t=Object(u.a)(n);function n(e){var i;return Object(o.a)(this,n),(i=t.call(this,e))._verbose=!1,i.handleSelect=i.handleSelect.bind(Object(c.a)(i)),i}return Object(l.a)(n,[{key:"handleSelect",value:function(e){this.props.handlePlanSelected(e,this.props.showPeriod)}},{key:"render",value:function(){var e,t,n,i,s,r,a,o,l,c,d,u,h,b,p=this,v=[],m=null,j=!1,f=null,x=(null===(e=this.props)||void 0===e||null===(t=e.currentSiteLimits)||void 0===t||null===(n=t.members)||void 0===n?void 0:n.total)||500,O=[],y=lt(null===(i=this.props)||void 0===i?void 0:i.prices,x,null===(s=this.props)||void 0===s?void 0:s.showPeriod);y&&y.length&&(null===(r=this.props)||void 0===r?void 0:r.currentSiteLimits)&&(m=y[0],O=dt(m,{currentSiteLimits:this.props.currentSiteLimits,product:this.props.name,productLimits:this.props.limits,verbose:this._verbose}));var k=ot(x)===at[at.length-1],S=k&&"starter"!==this.props.name.toLowerCase();if(this.props.features.map((function(e){return v.push(e)})),(null===(a=this.props)||void 0===a?void 0:a.addons)&&(null===(o=this.props)||void 0===o?void 0:o.addons.length)&&(u=(u=this.props.addons.filter((function(e){return e.name.toLowerCase().indexOf("subdirectory")>=0}))).length?u[0]:null)&&(h=(h=u.prices.filter((function(e){return e.billing_period===p.props.showPeriod}))).length?h[0]:null),m){var w,A,C=y.filter((function(e){var t;return e.cost===(null===(t=m)||void 0===t?void 0:t.cost)})),P=rt()(C,(function(e){return e.limits[0].value}));if(null===P||void 0===P||P.features.map((function(e){return e.indexOf("members")>=0?(S&&(e=N(at[at.length-1])+"+ members"),"starter"!==p.props.name.toLowerCase()?v.splice(1,0,e):v.splice(0,0,e)):v.push(e),v})),(null===(w=this.props)||void 0===w?void 0:w.currentPriceId)===(null===(A=m)||void 0===A?void 0:A.stripe_price_id)&&(j=!0,f="This is your current plan and billing period"),this.props.isSubdirectory&&h){var M,_,I,T,D=it(null===(M=h)||void 0===M?void 0:M.cost,null===(_=h)||void 0===_?void 0:_.billing_period),E=it(null===(I=m)||void 0===I?void 0:I.cost,null===(T=m)||void 0===T?void 0:T.billing_period);b=Object(Ie.jsx)("li",{children:"Managed subdirectory install"}),d=N(E+D)}else{var U,L;d=N(it(null===(U=m)||void 0===U?void 0:U.cost,null===(L=m)||void 0===L?void 0:L.billing_period))}}else if(this.props.prices){j=!0;var B=this.props.prices.filter((function(e){return e.billing_period===p.props.showPeriod})).sort((function(e,t){var n=e.limits,i=t.limits,s=n.filter((function(e){return"members"===e.name})),r=Object(g.a)(s,1)[0],a=i.filter((function(e){return"members"===e.name}));return Object(g.a)(a,1)[0].value-r.value}))[0];this._verbose&&console.log("[BMA] \u2192 fallback price for ".concat(this.props.name,":"),null===B||void 0===B?void 0:B.stripe_price_id,null===B||void 0===B?void 0:B.limits[0].value," members"),f="Not available with more than ".concat(N(null===B||void 0===B?void 0:B.limits[0].value)," members"),null===B||void 0===B||B.features.map((function(e){return e.indexOf("members")>=0?(S&&(e=N(at[at.length-1])+"+ members"),v.splice(1,0,e)):v.push(e),v})),d=N(it(null===B||void 0===B?void 0:B.cost,null===B||void 0===B?void 0:B.billing_period))}var F=v.map((function(e,t){return Object(Ie.jsx)("li",{children:e},t)}));this.props.isSubdirectory&&!h&&(j=!0,f="Not available with active subdirectory"),(null===(l=this.props)||void 0===l||null===(c=l.currentGhostVersion)||void 0===c?void 0:c.major)<4&&"starter"===this.props.name.toLowerCase()&&(j=!0,f="Not available with older Ghost versions"),O&&O.length>=1&&(j=!0,f=O[0].message);var R=!m||j||this.props.disabled?" plan-disabled":"";return Object(Ie.jsx)(Ie.Fragment,{children:S?Object(Ie.jsxs)("section",{children:[Object(Ie.jsxs)("header",{children:[Object(Ie.jsx)("h3",{children:this.props.name}),Object(Ie.jsxs)("div",{className:"price-more",children:[Object(Ie.jsxs)("p",{children:["Over ",Object(Ie.jsx)("strong",{children:"400,000"})," members?"]}),Object(Ie.jsxs)("p",{children:[Object(Ie.jsx)("a",{href:"mailto:concierge@ghost.org",children:"Contact us"})," to talk to our team"]})]})]}),Object(Ie.jsxs)("ul",{className:"plan-features",children:[F,b]})]}):Object(Ie.jsxs)("section",{className:"".concat(R),children:[Object(Ie.jsxs)("header",{children:[Object(Ie.jsx)("h3",{children:this.props.name}),Object(Ie.jsxs)("div",{className:"price",children:[Object(Ie.jsx)("div",{className:"price-sym",children:"$"}),Object(Ie.jsx)("div",{className:"price-amount",children:d}),Object(Ie.jsx)("div",{className:"price-term",children:"/mo"})]}),f&&Object(Ie.jsx)("div",{className:"price-unavailable",children:Object(Ie.jsx)("p",{children:f})}),!k&&!f&&Object(Ie.jsx)("button",{className:"gh-btn gh-btn-block","data-test-id":this.props.name,disabled:j,onClick:function(){return p.handleSelect(p.props.name.toLowerCase())},children:"Choose this plan"})]}),Object(Ie.jsxs)("ul",{className:"plan-features",children:[F,b]})]})})}}]),n}(s.a.Component),ht=function(e){Object(d.a)(n,e);var t=Object(u.a)(n);function n(e){var i;return Object(o.a)(this,n),(i=t.call(this,e))._isMounted=!1,e&&e.showNav(!1),i.state={loading:!0,showAnnual:!0,members:500,closeModal:!1},i.handlePlanSelected=i.handlePlanSelected.bind(Object(c.a)(i)),i.toggleAnnual=i.handleToggleAnnual.bind(Object(c.a)(i)),i.handleOpenModal=i.handleOpenModal.bind(Object(c.a)(i)),i.handleCloseModal=i.handleCloseModal.bind(Object(c.a)(i)),i.handleNestedLoadingState=i.handleNestedLoadingState.bind(Object(c.a)(i)),i.updateTitle=i.updateTitle.bind(Object(c.a)(i)),i}return Object(l.a)(n,[{key:"handleNestedLoadingState",value:function(e){this.setState({loading:e}),this.props.showNav(!e)}},{key:"componentDidMount",value:function(){var e=Object(f.a)(j.a.mark((function e(){var t,n,i,s,r,a,o,l,c;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._isMounted=!0,e.next=3,Y();case 3:if(t=e.sent,Me.b((function(e){var n,i,s,r;e.setTransactionName("Plans"),e.setUser({email:null===t||void 0===t||null===(n=t.user)||void 0===n?void 0:n.email_address}),e.setContext("billingData",{status:null===t||void 0===t||null===(i=t.subscription)||void 0===i?void 0:i.status,price:null===t||void 0===t||null===(s=t.currentPrice)||void 0===s?void 0:s.nickname,site:null===t||void 0===t||null===(r=t.currentSite)||void 0===r?void 0:r.url,exceededLimits:null===t||void 0===t?void 0:t.exceededLimits,forceUpgrade:null===t||void 0===t?void 0:t.isForceUpgrade}),e.setTag("section","plans")})),!t.isGrace||(null===t||void 0===t?void 0:t.forceUpgradeOwner)){e.next=8;break}return this.props.showNav(!0),e.abrupt("return",this.props.history.push("/"));case 8:if(!t.isIncomplete){e.next=10;break}return e.abrupt("return",this.props.history.push(t.checkoutRoute));case 10:return e.next=12,W("currentSiteLimits");case 12:if(n=e.sent,!this._isMounted){e.next=23;break}if(r=500,t&&!(null===t||void 0===t?void 0:t.errors)||(null===t||void 0===t?void 0:t.forceUpgradeOwner)){e.next=17;break}return e.abrupt("return",this.props.history.push("/"));case 17:if(this.updateTitle(t),(null===t||void 0===t?void 0:t.availableProducts)||(null===t||void 0===t?void 0:t.forceUpgradeOwner)){e.next=20;break}return e.abrupt("return",this.props.history.push("/"));case 20:(null===t||void 0===t||null===(i=t.currentSiteLimits)||void 0===i||null===(s=i.members)||void 0===s?void 0:s.total)&&(r=0===(null===t||void 0===t||null===(a=t.currentSiteLimits)||void 0===a||null===(o=a.members)||void 0===o?void 0:o.total)?r:null===t||void 0===t||null===(l=t.currentSiteLimits)||void 0===l||null===(c=l.members)||void 0===c?void 0:c.total),this.setState(Object(v.a)(Object(v.a)({},t),{},{currentSiteLimits:n,members:r,products:t.availableProducts,loading:!1})),this.props.showNav(!0);case 23:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){this.props.updateTitle("Billing and subscription settings"),this._isMounted=!1}},{key:"handleToggleAnnual",value:function(e){this.setState({showAnnual:e.target.checked})}},{key:"handlePlanSelected",value:function(e,t){return t?this.props.history.push("/checkout/".concat(e,"-").concat(t)):this.props.history.push("/checkout/".concat(e))}},{key:"handleOpenModal",value:function(){this.setState({closeModal:!1})}},{key:"updateTitle",value:function(){var e=Object(f.a)(j.a.mark((function e(t){var n,i,s,r,a,o,l;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=4;break}return e.next=3,Y();case 3:t=e.sent;case 4:if(!(null===(n=t)||void 0===n?void 0:n.isTrial)){e.next=20;break}a=new Date(t.subscription.trial_end),o=Object(tt.a)(a,new Date),e.t0=o,e.next=0===e.t0?10:1===e.t0?12:14;break;case 10:return l="<strong>today</strong>",e.abrupt("break",16);case 12:return l="in <strong>".concat(o," day</strong>"),e.abrupt("break",16);case 14:return l="in <strong>".concat(o," days</strong>"),e.abrupt("break",16);case 16:this.setState({trialWording:l}),this.props.updateTitle("Your trial ends ".concat(this.state.trialWording,". You can pick a plan now to start your subscription and unlock the full features of Ghost(Pro) right away.")),e.next=21;break;case 20:(null===(i=t)||void 0===i?void 0:i.isForceUpgrade)&&"trial"===(null===(s=t)||void 0===s?void 0:s.lastSubscriptionType)?this.props.updateTitle("Your free trial is over! Pick a plan now, and unlock the full features of Ghost(Pro)"):(null===(r=t)||void 0===r?void 0:r.isTrial)?this.props.updateTitle("Pick a plan now to start a subscription and keep your work online."):this.props.updateTitle("Select a new plan to fit your needs.");case 21:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"handleCloseModal",value:function(){this.setState({closeModal:!0})}},{key:"render",value:function(){var e,t,n,s,r,a,o,l,c=this,d=Object(Ie.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 12 12",height:"12",width:"12",children:Object(Ie.jsxs)("g",{transform:"matrix(0.5,0,0,0.5,0,0)",children:[Object(Ie.jsx)("line",{style:{fill:"none",stroke:"#000000",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5px"},x1:"9.25",y1:"14.523",x2:"23.25",y2:"0.75"}),Object(Ie.jsx)("polyline",{style:{fill:"none",stroke:"#000000",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5px"},points:"23.25 8.621 23.25 0.75 15.25 0.75"}),Object(Ie.jsx)("path",{style:{fill:"none",stroke:"#000000",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5px"},d:"M12.125,5.75H1.625a.875.875,0,0,0-.875.875v15.75a.875.875,0,0,0,.875.875h15.75a.875.875,0,0,0,.875-.875v-10.5"})]})});(null===(e=this.state)||void 0===e?void 0:e.loading)||(a=null===(l=this.state)||void 0===l?void 0:l.products.filter((function(e){return"personal"!==e.name.toLowerCase()&&"trial"!==e.name.toLowerCase()})).sort((function(e,t){return e.order-t.order})).map((function(e){var t,n,s,r,a,o;return Object(i.createElement)(ut,Object(v.a)(Object(v.a)({},e),{},{handlePlanSelected:c.handlePlanSelected,key:e.name,currentPriceId:null===(t=c.state)||void 0===t||null===(n=t.currentPrice)||void 0===n?void 0:n.stripe_price_id,showPeriod:c.state.showAnnual?"year":"month",isSubdirectory:null===(s=c.state)||void 0===s||null===(r=s.currentSite)||void 0===r?void 0:r.subdirectory,currentGhostVersion:null===(a=c.state)||void 0===a?void 0:a.currentGhostVersion,currentSiteLimits:null===(o=c.state)||void 0===o?void 0:o.currentSiteLimits}))})));return this.state.isTrial&&(o=Object(Ie.jsx)(Qe,Object(v.a)(Object(v.a)({},this.state),{},{setLoadingState:this.handleNestedLoadingState,closeModal:this.handleCloseModal}))),Object(Ie.jsx)("main",{className:"main main-wide",children:(null===(t=this.state)||void 0===t?void 0:t.loading)?Object(Ie.jsx)("div",{className:"gh-loading-content",children:Object(Ie.jsx)("div",{className:"gh-loading-spinner"})}):Object(Ie.jsxs)(Ie.Fragment,{children:[Object(Ie.jsxs)("div",{className:"planselect","data-test-id":"plans",children:[Object(Ie.jsxs)("section",{className:"plancalc",children:[Object(Ie.jsxs)("header",{children:[0===(null===(n=this.state)||void 0===n||null===(s=n.currentSiteLimits)||void 0===s?void 0:s.members.total)?Object(Ie.jsxs)("h3",{children:["Including an audience ",Object(Ie.jsx)("br",{}),"of up to"]}):Object(Ie.jsxs)("h3",{children:["Based your total ",Object(Ie.jsx)("br",{}),"audience size of"]}),Object(Ie.jsxs)("div",{className:"plancalc-memberscount",children:[Object(Ie.jsx)("div",{className:"plancalc-memberscount-number",children:N(null===(r=this.state)||void 0===r?void 0:r.members)}),Object(Ie.jsx)("div",{className:"plancalc-memberscount-label",children:"Members"})]}),Object(Ie.jsxs)("a",{href:"https://ghost.org/pricing/",target:"_blank",rel:"noopener noreferrer",children:["View detailed pricing table",Object(Ie.jsx)("span",{className:"link-ext",children:d})]}),Object(Ie.jsx)("p",{children:"Members are people who have signed up to your site. They can log in, receive email newsletters, or buy paid subscriptions."})]}),Object(Ie.jsxs)("footer",{children:[Object(Ie.jsx)("div",{children:Object(Ie.jsx)("strong",{children:"Annual discount"})}),Object(Ie.jsxs)("span",{children:[Object(Ie.jsx)("input",{id:"interval",className:"toggle-btn",type:"checkbox",name:"interval",defaultChecked:!0,onChange:this.toggleAnnual}),Object(Ie.jsx)("label",{className:"hidden",htmlFor:"interval"})]})]})]}),a]}),Object(Ie.jsxs)("footer",{className:"planselector-footer ".concat(o?"two-columns":""),children:[Object(Ie.jsx)("div",{className:"footer-cancel",children:o}),Object(Ie.jsx)("div",{className:"footer-compare",children:Object(Ie.jsx)("a",{href:"https://ghost.org/pricing/",target:"_blank",rel:"noopener noreferrer",children:"View full pricing page \u2192"})})]})]})})}}]),n}(s.a.Component),bt=Object(p.g)(ht),pt=n(159),vt=n.n(pt),mt=function(e){Object(d.a)(n,e);var t=Object(u.a)(n);function n(e){var i;return Object(o.a)(this,n),(i=t.call(this,e))._verbose=!1,i._isMounted=!1,i.stripe=null,i.buttonStates={success:{className:"gh-btn gh-btn-block gh-btn-green",html:"Done",disabled:!0},warning:{className:"gh-btn gh-btn-block gh-btn-green",html:"Done",disabled:!1},fail:{className:"gh-btn gh-btn-block gh-btn-red",html:"Try again",onSubmit:function(e){return i.confirmAndSubmit(e)},disabled:!1},pending:{className:"gh-btn gh-btn-green gh-btn-block spinner",html:'<span><div class="gh-spinner"></div></span>',disabled:!0},default:{className:"gh-btn gh-btn-green gh-btn-block",html:"Confirm plan selection",onSubmit:function(e){return i.confirmAndSubmit(e)},disabled:!1},scaRetry:{className:"gh-btn gh-btn-block gh-btn-red",html:"Complete payment now",onSubmit:function(e){return i.confirmAndSubmit(e)},disabled:!1}},e&&e.showNav(!1),i.state={suitablePrice:null,selectedAddons:[],availableAddons:[],comparablePrice:null,subscription:null,period:null,loading:!0,errors:null,amountDue:0,endingBalance:0,closeModal:!1,buttonState:i.buttonStates.default,btnDisabled:!1,isSCARetry:!1,isPendingOrIncompletePrice:!1},i.togglePeriod=i.togglePeriod.bind(Object(c.a)(i)),i.addAddonToCheckout=i.handleAddonAdded.bind(Object(c.a)(i)),i.removeAddonFromCheckout=i.handleAddonRemoved.bind(Object(c.a)(i)),i.toggleAddonDetails=i.toggleAddonDetails.bind(Object(c.a)(i)),i.confirmAndSubmit=i.handleConfirmAndSubmit.bind(Object(c.a)(i)),i.getAnnualDiscount=i.getAnnualDiscount.bind(Object(c.a)(i)),i.getMonthlyEquivalentPrice=i.getMonthlyEquivalentPrice.bind(Object(c.a)(i)),i.getTotalPrice=i.getTotalPrice.bind(Object(c.a)(i)),i.getAmountDue=i.getAmountDue.bind(Object(c.a)(i)),i.ensureStripeLoaded=i.ensureStripeLoaded.bind(Object(c.a)(i)),i.handleOpenModal=i.handleOpenModal.bind(Object(c.a)(i)),i.handleCloseModal=i.handleCloseModal.bind(Object(c.a)(i)),i.handleNestedLoadingState=i.handleNestedLoadingState.bind(Object(c.a)(i)),i.delayedReturnToDashboard=i.delayedReturnToDashboard.bind(Object(c.a)(i)),i.handlePaymentSCA=i.handlePaymentSCA.bind(Object(c.a)(i)),i.doSCAPayment=i.doSCAPayment.bind(Object(c.a)(i)),i.setPendingOrIncompletePrice=i.setPendingOrIncompletePrice.bind(Object(c.a)(i)),i.findComparablePrice=i.findComparablePrice.bind(Object(c.a)(i)),i.getMembersIncluded=i.getMembersIncluded.bind(Object(c.a)(i)),i}return Object(l.a)(n,[{key:"findComparablePrice",value:function(e,t){return e.find((function(e){var n=vt()(null===t||void 0===t?void 0:t.limits,null===e||void 0===e?void 0:e.limits),i=(null===e||void 0===e?void 0:e.billing_period)!==(null===t||void 0===t?void 0:t.billing_period);return n&&i}))}},{key:"getMembersIncluded",value:function(e){return e.limits.find((function(e){return"members"===e.name?e.value:null}))}},{key:"handleOpenModal",value:function(){this.setState({closeModal:!1})}},{key:"handleCloseModal",value:function(){var e=Object(f.a)(j.a.mark((function e(t){var n,i,s,r,a,o=this;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=t.reload)||!0!==n){e.next=21;break}return this.props.showNav(!1),this.setState({closeModal:!0,loading:!0,errors:null,buttonState:this.buttonStates.pending,btnDisabled:!1}),e.prev=4,e.next=7,X();case 7:return s=e.sent,this.setState(Object(v.a)(Object(v.a)({},s),{},{_invoiceDetails:s.invoiceDetails,buttonState:Object(v.a)(Object(v.a)({},this.buttonStates.default),{},{disabled:!(null===(i=s.user)||void 0===i?void 0:i.cardType)})})),e.next=11,W("currentPrice");case 11:r=e.sent,this.setState(Object(v.a)(Object(v.a)({},r),{},{loading:!1})),e.next=19;break;case 15:return e.prev=15,e.t0=e.catch(4),Me.a(e.t0,{tags:{pointer:"handleCloseModal_reload"}}),e.abrupt("return",this.setState({errors:"Oops, something went wrong. Please refresh the site and try again.",buttonState:this.buttonStates.fail,loading:!1}));case 19:e.next=32;break;case 21:return e.prev=21,e.next=24,Y();case 24:a=e.sent,this.setState((function(e){return Object(v.a)(Object(v.a)({},a),{},{_invoiceDetails:a.invoiceDetails,closeModal:!0,buttonState:e.isPendingOrIncompletePrice?o.buttonStates.scaRetry:Object(v.a)({},o.buttonStates.default)})})),e.next=32;break;case 28:return e.prev=28,e.t1=e.catch(21),Me.a(e.t1,{tags:{pointer:"handleCloseModal_cached"}}),e.abrupt("return",this.setState({errors:"Oops, something went wrong. Please refresh the site and try again.",buttonState:this.buttonStates.fail,loading:!1}));case 32:case"end":return e.stop()}}),e,this,[[4,15],[21,28]])})));return function(t){return e.apply(this,arguments)}}()},{key:"setPendingOrIncompletePrice",value:function(){var e,t,n,i,s,r,a,o,l,c,d,u=this;if((null===(e=this.state.pendingSubscription)||void 0===e?void 0:e.priceId)===(null===(t=this.state.suitablePrice)||void 0===t?void 0:t.stripe_price_id)||this.state.isIncomplete&&(null===(n=this.state)||void 0===n||null===(i=n.pendingSubscription)||void 0===i||null===(s=i.product)||void 0===s?void 0:s.toLowerCase())===(null===(r=this.state)||void 0===r||null===(a=r.selectedBaseProduct)||void 0===a||null===(o=a.name)||void 0===o?void 0:o.toLowerCase())&&(null===(l=this.state)||void 0===l||null===(c=l.pendingSubscription)||void 0===c?void 0:c.period)===(null===(d=this.state)||void 0===d?void 0:d.period)){var h,b,p,v,m,j,f,g,x;if(this.state.isIncomplete&&(null===(h=this.state)||void 0===h||null===(b=h.pendingSubscription)||void 0===b||null===(p=b.product)||void 0===p?void 0:p.toLowerCase())===(null===(v=this.state)||void 0===v||null===(m=v.selectedBaseProduct)||void 0===m||null===(j=m.name)||void 0===j?void 0:j.toLowerCase())&&(null===(f=this.state)||void 0===f||null===(g=f.pendingSubscription)||void 0===g?void 0:g.period)===(null===(x=this.state)||void 0===x?void 0:x.period)){var O,y=null===(O=this.state.selectedBaseProduct)||void 0===O?void 0:O.prices.find((function(e){var t;return e.stripe_price_id===(null===(t=u.state.pendingSubscription)||void 0===t?void 0:t.priceId)})),k=this.getMembersIncluded(y);this.setState({suitablePrice:y,membersIncluded:null===k||void 0===k?void 0:k.value})}return this.setState({isPendingOrIncompletePrice:!0})}return this.setState({isPendingOrIncompletePrice:!1})}},{key:"handlePaymentSCA",value:function(){var e=Object(f.a)(j.a.mark((function e(){var t,n,i,s,r,a,o,l,c,d,u,h,b,p,m,g,x,O=this,y=arguments;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=y.length>0&&void 0!==y[0]?y[0]:(null===(t=this.state)||void 0===t||null===(n=t.subscription)||void 0===n?void 0:n.customer_id)||(null===(i=this.state)||void 0===i||null===(s=i.user)||void 0===s?void 0:s.stripe_token),l=y.length>1?y[1]:void 0,c=y.length>2?y[2]:void 0,d={},o){e.next=13;break}return e.next=7,X();case 7:if(u=e.sent,h=u.subscription,b=u.user,(h||h.customer_id)&&(b||b.stripe_token)){e.next=12;break}return e.abrupt("return",this.props.history("/"));case 12:o=(null===h||void 0===h?void 0:h.customer_id)||(null===b||void 0===b?void 0:b.stripe_token);case 13:if(this.setState({buttonState:this.buttonStates.pending,errors:null,btnDisabled:!0}),e.prev=14,this.state.isSCARetry||!l||!c){e.next=22;break}return this.setState({isSCARetry:!1}),e.next=19,this.doSCAPayment(l,c);case 19:d=e.sent,e.next=36;break;case 22:if(l&&!this.state.isPendingOrIncompletePrice){e.next=27;break}return e.next=25,me({customerId:o});case 25:m=e.sent,l=null===m||void 0===m||null===(p=m.payment_intent)||void 0===p?void 0:p.client_secret;case 27:if(c&&!this.state.isPendingOrIncompletePrice){e.next=32;break}return e.next=30,de({customerId:o});case 30:g=e.sent,c=g.paymentMethodId;case 32:return this.setState({isSCARetry:!1}),e.next=35,this.doSCAPayment(l,c);case 35:d=e.sent;case 36:e.next=42;break;case 38:return e.prev=38,e.t0=e.catch(14),Me.a(e.t0,{tags:{pointer:"handlePaymentSCA"}}),e.abrupt("return",this.setState({errors:"We weren't able to process your payment. Please try again or choose a different card.",buttonState:this.buttonStates.fail,isSCARetry:!0,btnDisabled:!1}));case 42:if(!d||"succeeded"!==(null===(r=d)||void 0===r||null===(a=r.paymentIntent)||void 0===a?void 0:a.status)){e.next=50;break}this._verbose&&console.time("[CHECKOUT] SCA success, delay fetching subscription");try{window.localStorage.removeItem("gh_checkout_".concat(o))}catch(k){console.error("Unable to remove item from local storage",k)}return this.props.showNav(!1),this.setState({loading:!0,btnDisabled:!0,pendingSubscription:null,isPendingOrIncompletePrice:!1,isSCARetry:!1,isIncomplete:!1,isPending:!1}),e.abrupt("return",setTimeout(Object(f.a)(j.a.mark((function e(){var t,n;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return O._verbose&&console.timeEnd("[CHECKOUT] SCA success, delay fetching subscription"),e.next=3,X({sca:"succeeded"});case 3:return e.next=5,W("currentProduct");case 5:return e.next=7,W("invoices",{userId:null===(t=O.state)||void 0===t||null===(n=t.user)||void 0===n?void 0:n.id});case 7:return e.next=9,W("currentSite",{data:O.state.blogs});case 9:return e.next=11,O.handleCloseModal({reload:!1});case 11:return O.props.updateTitle("Billing and subscription settings"),O.props.showNav(!0),e.abrupt("return",O.props.history.replace("/",{}));case 14:case"end":return e.stop()}}),e)}))),7e3));case 50:return e.next=52,X();case 52:if(x=e.sent,this.setState(Object(v.a)(Object(v.a)({},x),{},{errors:"We weren't able to process your payment. Please try again or choose a different card.",buttonState:this.buttonStates.fail,isSCARetry:!0})),!(null===x||void 0===x?void 0:x.isIncomplete)){e.next=58;break}return e.abrupt("return",this.setState({btnDisabled:!0}));case 58:if(!(null===x||void 0===x?void 0:x.isPending)){e.next=60;break}return e.abrupt("return",this.setState({btnDisabled:!1}));case 60:case"end":return e.stop()}}),e,this,[[14,38]])})));return function(){return e.apply(this,arguments)}}()},{key:"doSCAPayment",value:function(){var e=Object(f.a)(j.a.mark((function e(t,n){var i;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stripe;case 2:if(i=e.sent){e.next=5;break}return e.abrupt("return");case 5:return e.next=7,i.confirmCardPayment(t,{payment_method:n});case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"handleNestedLoadingState",value:function(e){this.setState({loading:e})}},{key:"delayedReturnToDashboard",value:function(){var e=Object(f.a)(j.a.mark((function e(){var t=this;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._verbose&&console.time("[CHECKOUT] Delay and return to Dashboard"),e.abrupt("return",setTimeout(Object(f.a)(j.a.mark((function e(){var n,i,s,r;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t._verbose&&console.timeEnd("[CHECKOUT] Delay and return to Dashboard"),e.prev=1,e.next=4,W("invoices",{userId:null===(i=t.state)||void 0===i||null===(s=i.user)||void 0===s?void 0:s.id});case 4:return e.next=6,W("currentSite",{data:t.state.blogs});case 6:e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),t._verbose&&console.log("[BMA] Error receiving invoice and currentSite:",e.t0);case 11:return e.next=13,t.handleCloseModal({reload:!1});case 13:if(!(null===(n=t.state)||void 0===n?void 0:n.forceUpgradeOwner)){e.next=18;break}return e.next=16,V();case 16:r=e.sent,t._verbose&&console.log("[CHECKOUT] Updated billingData:",r);case 18:return t.props.updateTitle("Billing and subscription settings"),e.abrupt("return",t.props.history.replace("/",{}));case 20:case"end":return e.stop()}}),e,null,[[1,8]])}))),7e3));case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentDidMount",value:function(){var e=Object(f.a)(j.a.mark((function e(){var t,n,i,s,r,a,o,l,c,d,u,h,b,p,m,f,x,O,y,k,S,w,N,A,C,P,M,_,I,T,D,E;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=[],i=/^(\w*)(?:-)(\w*)?$/gim,this.props.updateTitle("Confirm your plan selection"),this._isMounted=!0,this.stripe=this.ensureStripeLoaded(),Me.b((function(e){return e.setTransactionName("Checkout")})),(s=this.props.match.params.id)&&!(s.indexOf("personal")>=0)){e.next=9;break}return e.abrupt("return",this.props.history.push("/"));case 9:return r=i.exec(s),a=Object(g.a)(r,3),o=a[1],l=a[2],this.setState({selectedProduct:o,period:l,buttonState:Object(v.a)(Object(v.a)({},this.buttonStates.default),{},{disabled:!0})}),e.next=14,Y();case 14:if(c=e.sent,Me.b((function(e){var t,n,i,s;e.setUser({email:null===c||void 0===c||null===(t=c.user)||void 0===t?void 0:t.email_address}),e.setContext("billingData",{status:null===c||void 0===c||null===(n=c.subscription)||void 0===n?void 0:n.status,price:null===c||void 0===c||null===(i=c.currentPrice)||void 0===i?void 0:i.nickname,site:null===c||void 0===c||null===(s=c.currentSite)||void 0===s?void 0:s.url,exceededLimits:null===c||void 0===c?void 0:c.exceededLimits,forceUpgrade:null===c||void 0===c?void 0:c.isForceUpgrade,param:r}),e.setTag("section","checkout")})),!c.isGrace){e.next=18;break}return e.abrupt("return",this.props.history.push("/"));case 18:return e.next=20,W("currentSiteLimits");case 20:if(d=e.sent,!this._isMounted){e.next=65;break}if(k=null===c||void 0===c||null===(u=c.user)||void 0===u?void 0:u.cardType,S=Object(v.a)(Object(v.a)({},this.buttonStates.default),{},{disabled:!k}),w=null,N=[],A=null===c||void 0===c||null===(h=c.currentSite)||void 0===h?void 0:h.subdirectory,(null===c||void 0===c?void 0:c.isIncomplete)||c&&!(null===c||void 0===c?void 0:c.errors)&&(null===c||void 0===c?void 0:c.availableProducts)){e.next=29;break}return e.abrupt("return",this.props.history.push("/"));case 29:if(C=null===c||void 0===c?void 0:c.availableProducts.find((function(e){return e.name.toLowerCase()===o.toLowerCase()}))){e.next=33;break}return this._verbose&&console.log("[CHECKOUT] Product not available or doesn't exist:",o),e.abrupt("return",this.props.history.push("/plans"));case 33:if(A&&(null===C||void 0===C||null===(b=C.addons)||void 0===b?void 0:b.length)&&(this._verbose&&console.log("[CHECKOUT] Subdirectory addon available in  ".concat(null===C||void 0===C?void 0:C.name," product.")),w=C.addons),P=(null===c||void 0===c||null===(p=c.currentSiteLimits)||void 0===p||null===(m=p.members)||void 0===m?void 0:m.total)||500,M=ot(P),w&&A&&(this._verbose&&console.log("[CHECKOUT] Subdirectory addon required"),N=w),this._verbose&&console.log("[CHECKOUT] Selected base product: ",null===C||void 0===C?void 0:C.name),(_=lt(null===C||void 0===C?void 0:C.prices,M,l))&&_.length&&d&&(t=_[0],n=dt(t,{currentSiteLimits:d,product:null===C||void 0===C?void 0:C.name,productLimits:null===C||void 0===C?void 0:C.limits,verbose:this._verbose})),_&&_.length&&(!n||!n.length)){e.next=42;break}return e.abrupt("return",this.props.history.push("/plans"));case 42:if(this._verbose&&console.log("[CHECKOUT] Suitable price for ".concat(P," members: "),t),I={},w&&w.length&&w.forEach((function(e){var t=e.name;return I[t]=!1})),T=this.findComparablePrice(C.prices,t),D=this.getMembersIncluded(t),this.setState(Object(v.a)(Object(v.a)({},c),{},{_invoiceDetails:c.invoiceDetails,selectedBaseProduct:C,availableAddons:w||null,suitablePrice:t,comparablePrice:T,amountDue:0,showAddon:I,selectedAddons:N,selectedAddonsPrices:[],membersIncluded:null===D||void 0===D?void 0:D.value,period:t.billing_period,loading:!1,buttonState:S,errors:k?null:"Please add a card to continue"})),!(null===this||void 0===this||null===(f=this.state)||void 0===f?void 0:f.pendingSubscription)){e.next=58;break}if(E={isSCARetry:!0},!c.isIncomplete){e.next=56;break}if(E.amountDue=this.getTotalPrice(),E.btnDisabled=!0,this.setState(E),window.location.pathname===this.state.checkoutRoute){e.next=56;break}return e.abrupt("return",this.props.history.push("/checkout/".concat(this.state.checkoutRoute)));case 56:this.setPendingOrIncompletePrice(),this.state.isPendingOrIncompletePrice&&(this.props.updateTitle("Complete payment authorization"),S=this.buttonStates.scaRetry,this.setState(E));case 58:if(this.state.isPendingOrIncompletePrice||(null===(x=this.state.suitablePrice)||void 0===x?void 0:x.stripe_price_id)!==(null===(O=this.state)||void 0===O||null===(y=O.currentPrice)||void 0===y?void 0:y.stripe_price_id)){e.next=62;break}return e.abrupt("return",this.setState({errors:"This is your current plan. Please choose a different period or plan.",buttonState:Object(v.a)(Object(v.a)({},this.buttonStates.default),{},{disabled:!0})}));case 62:return this.setState({buttonState:S,amountDue:this.getTotalPrice()}),e.next=65,this.getAmountDue(t.stripe_price_id,t.billing_period);case 65:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){this.props.updateTitle("Billing and subscription settings"),this.props.showNav(!0),this._isMounted=!1}},{key:"togglePeriod",value:function(){var e=Object(f.a)(j.a.mark((function e(t){var n,i,s,r,a,o,l;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._verbose&&console.log("[CHECKOUT] Selected period:",t),this.state.suitablePrice.billing_period===t){e.next=16;break}return l=this.state.isPendingOrIncompletePrice?this.buttonStates.scaRetry:Object(v.a)(Object(v.a)({},this.buttonStates.default),{},{disabled:!(null===(n=this.state)||void 0===n||null===(i=n.user)||void 0===i?void 0:i.cardType)}),this.setState({amountDue:0,endingBalance:0,startBalance:0,proration:0,errors:(null===(s=this.state.user)||void 0===s?void 0:s.cardType)?null:"Please add a card to continue"}),this.props.history.push("/checkout/".concat(this.state.selectedBaseProduct.name.toLowerCase(),"-").concat(t)),e.next=7,this.setState((function(e){return{period:t,suitablePrice:e.comparablePrice,comparablePrice:e.suitablePrice,buttonState:l}}));case 7:if((null===(r=this.state.suitablePrice)||void 0===r?void 0:r.stripe_price_id)!==(null===(a=this.state)||void 0===a||null===(o=a.currentPrice)||void 0===o?void 0:o.stripe_price_id)){e.next=11;break}return e.abrupt("return",this.setState({errors:"This is your current plan. Please choose a different period or plan.",buttonState:Object(v.a)(Object(v.a)({},this.buttonStates.default),{},{disabled:!0})}));case 11:return e.next=13,this.setState({buttonState:l});case 13:return this.setPendingOrIncompletePrice(),e.next=16,this.getAmountDue(this.state.suitablePrice.stripe_price_id,t);case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"toggleAddonDetails",value:function(e){var t=this.state.showAddon;t[e]=!t[e],this.setState({addonState:t})}},{key:"ensureStripeLoaded",value:function(){var e=Object(f.a)(j.a.mark((function e(){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(Fe.a)("pk_live_XsbJ2DC9W2rf9cCj7ELbelvq");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"getMonthlyEquivalentPrice",value:function(){var e,t,n=(null===(e=this.state)||void 0===e?void 0:e.comparablePrice)||(null===(t=this.state)||void 0===t?void 0:t.suitablePrice);return Math.max(it(this.state.suitablePrice.cost,this.state.suitablePrice.billing_period),it(n.cost,n.billing_period))}},{key:"getAnnualDiscount",value:function(e){var t=12*this.getMonthlyEquivalentPrice(),n=nt(this.state.suitablePrice.cost,this.state.suitablePrice.billing_period),i=0;return(i=(null===e||void 0===e?void 0:e.percentage)?Math.round(100*(t-n)/t):t-n)>0?i:null}},{key:"getTotalPrice",value:function(){var e,t,n,i,s=this;return(null===(e=this.state)||void 0===e?void 0:e.selectedAddons)&&(i=this.state.selectedAddons.map((function(e){return e.prices.filter((function(e){return e.billing_period===s.state.period}))[0]}))[0]),((null===(t=i)||void 0===t?void 0:t.cost)||0)+(null===(n=this.state.suitablePrice)||void 0===n?void 0:n.cost)}},{key:"getAmountDue",value:function(){var e=Object(f.a)(j.a.mark((function e(t,n){var i,s,r,a,o,l,c,d,u,h,b,p,m,f;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l={},c=this.state.isPendingOrIncompletePrice?this.buttonStates.scaRetry:this.buttonStates.default,d=this.getTotalPrice(),!(null===(i=this.state)||void 0===i?void 0:i.isTrial)&&!(null===(s=this.state)||void 0===s?void 0:s.forceUpgradeOwner)){e.next=5;break}return e.abrupt("return",this.setState({amountDue:d}));case 5:return this.setState({buttonState:Object(v.a)(Object(v.a)({},c),{},{disabled:!0})}),(null===(r=this.state)||void 0===r?void 0:r.selectedAddons)&&this.state.selectedAddons.map((function(e){return e.prices.forEach((function(e){return e.billing_period===n?l.selected=e.stripe_price_id:l.current=e.stripe_price_id}))})),e.next=9,fe({customerId:this.state.subscription.customer_id,basePrices:{current:null===(a=this.state)||void 0===a||null===(o=a.currentPrice)||void 0===o?void 0:o.stripe_price_id,selected:t||this.state.suitablePrice.stripe_price_id},addonPrices:l,subscriptionId:this.state.subscription.stripe_subscription_id,period:n||this.state.period});case 9:u=e.sent,h=u.amount,b=u.endingBalance,p=u.prorationDate,m=u.startBalance,f=b-d,0===b&&m<=0&&(f=-1*(d-h)),this.setState({amountDue:h?h.toFixed(2):0,endingBalance:b?b.toFixed(2):0,proration:f?f.toFixed(2):0,prorationDate:p,buttonState:c});case 17:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"handleAddonAdded",value:function(e){var t,n,i=this,s=this.state.selectedAddons;s.push(e),(null===(t=this.state)||void 0===t?void 0:t.selectedAddons)&&(n=s.map((function(e){return e.prices.filter((function(e){return e.billing_period===i.state.period}))[0]}))),this.setState({selectedAddons:s,selectedAddonsPrices:n})}},{key:"handleAddonRemoved",value:function(e){var t,n,i=this,s=this.state.selectedAddons;s=s.filter((function(t){return t.name!==e.name})),(null===(t=this.state)||void 0===t?void 0:t.selectedAddons)&&(n=s.map((function(e){return e.prices.filter((function(e){return e.billing_period===i.state.period}))[0]}))),this.setState({selectedAddons:s,selectedAddonsPrices:n})}},{key:"handleConfirmAndSubmit",value:function(){var e=Object(f.a)(j.a.mark((function e(t){var n,i,s,r,a,o,l,c,d,u,h,b,p,m,f,g,x,O,y,k,S,w,N,A,C,P,M,_,I,T,D,E,U,L,B,F=this;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u=[],t.preventDefault(),this.setState({buttonState:this.buttonStates.pending,errors:null,btnDisabled:!0}),!(null===(n=this.state)||void 0===n?void 0:n.isPendingOrIncompletePrice)){e.next=6;break}return this._verbose&&console.log("[CHECKOUT] Pending or incomplete price, handle SCA payment"),e.abrupt("return",this.handlePaymentSCA(this.state.subscription.customer_id||this.state.user.stripe_token));case 6:if((null===this||void 0===this||null===(i=this.state)||void 0===i||null===(s=i.suitablePrice)||void 0===s?void 0:s.stripe_price_id)!==(null===(r=this.state)||void 0===r||null===(a=r.currentPrice)||void 0===a?void 0:a.stripe_price_id)){e.next=8;break}return e.abrupt("return",this.setState({buttonState:this.buttonStates.fail,errors:"This is your current plan. Please choose a different period or plan.",btnDisabled:!1}));case 8:return(null===this||void 0===this||null===(o=this.state)||void 0===o||null===(l=o.selectedAddons)||void 0===l?void 0:l.length)&&this.state.selectedAddons.map((function(e){var t=e.prices.filter((function(e){return e.billing_period===F.state.period}))[0];return u.push(t.stripe_price_id)})),e.next=11,W("currentSiteLimits");case 11:if(h=e.sent,!((b=dt(this.state.suitablePrice,{currentSiteLimits:h,product:null===(c=this.state.selectedBaseProduct)||void 0===c?void 0:c.name,productLimits:null===(d=this.state.selectedBaseProduct)||void 0===d?void 0:d.limits,verbose:this._verbose}))&&b.length>=1)){e.next=15;break}return e.abrupt("return",this.setState({buttonState:this.buttonStates.fail,errors:b[0].message,btnDisabled:!1}));case 15:return p={customerId:this.state.subscription.customer_id||this.state.user.stripe_token,subscriptionId:this.state.subscription.id,planId:this.state.suitablePrice.stripe_price_id,addonIds:u,isTrial:this.state.isTrial,userId:this.state.user.id,prorationDate:this.state.prorationDate},e.next=18,de(p);case 18:if(m=e.sent,f=m.paymentMethodId,m.errors||!f){e.next=53;break}return this.setState({errors:null}),p.paymentMethodId=f,e.prev=24,e.next=27,xe(p);case 27:if(w=e.sent,N=(null===(g=this.state)||void 0===g||null===(x=g.subscription)||void 0===x?void 0:x.customer_id)||(null===(O=this.state)||void 0===O||null===(y=O.user)||void 0===y?void 0:y.stripe_token),this._verbose&&console.log("[CHECKOUT] \u2192 billingDataResponse",w),!((null===w||void 0===w?void 0:w.errors)&&(null===w||void 0===w||null===(k=w.errors)||void 0===k||null===(S=k.message)||void 0===S?void 0:S.indexOf("Error fetching invoices"))<0)){e.next=32;break}return e.abrupt("return",this.setState({errors:(null===w||void 0===w||null===(A=w.errors)||void 0===A?void 0:A.message)||"Could not process your card. Please contact support@ghost.org",buttonState:this.buttonStates.fail,btnDisabled:!1}));case 32:if(!w.isIncomplete&&!w.isPending){e.next=43;break}D={product:null===(C=this.state)||void 0===C?void 0:C.selectedProduct,period:null===(P=this.state)||void 0===P?void 0:P.period,priceId:null===(M=this.state)||void 0===M||null===(_=M.suitablePrice)||void 0===_?void 0:_.stripe_price_id};try{window.localStorage.setItem("gh_checkout_".concat(N),JSON.stringify(D))}catch(j){Me.a(j,{tags:{pointer:"set_localStorage"}}),console.error("Unable to set local storage",j)}if(this.setState(Object(v.a)(Object(v.a)({pendingSubscription:D},w),{},{isPendingOrIncompletePrice:!0})),!(null===w||void 0===w||null===(I=w.subscription)||void 0===I||null===(T=I.meta)||void 0===T?void 0:T.paymentIntentSecret)||!f){e.next=40;break}return e.abrupt("return",this.handlePaymentSCA(null===w||void 0===w||null===(E=w.subscription)||void 0===E?void 0:E.customer_id,null===w||void 0===w||null===(U=w.subscription)||void 0===U||null===(L=U.meta)||void 0===L?void 0:L.paymentIntentSecret,f));case 40:return e.abrupt("return",this.handlePaymentSCA(null===w||void 0===w||null===(B=w.subscription)||void 0===B?void 0:B.customer_id));case 41:e.next=45;break;case 43:try{window.localStorage.removeItem("gh_checkout_".concat(N))}catch(j){Me.a(j,{tags:{pointer:"remove_localStorage"}}),console.error("Unable to remove item from local storage",j)}return e.abrupt("return",this.delayedReturnToDashboard());case 45:e.next=51;break;case 47:return e.prev=47,e.t0=e.catch(24),Me.a(e.t0,{tags:{pointer:"handleConfirmAndSubmit"}}),e.abrupt("return",this.setState({errors:(null===e.t0||void 0===e.t0?void 0:e.t0.message)||"Could not process your card. Please contact support@ghost.org",buttonState:this.buttonStates.fail,btnDisabled:!1}));case 51:e.next=54;break;case 53:return e.abrupt("return",this.setState({buttonState:this.buttonStates.fail,errors:"Card authentication failed. Please try again or contact support@ghost.org",btnDisabled:!1}));case 54:case"end":return e.stop()}}),e,this,[[24,47]])})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e,t=this;if(null===(e=this.state)||void 0===e?void 0:e.loading)return Object(Ie.jsx)("div",{className:"gh-loading-content",children:Object(Ie.jsx)("div",{className:"gh-loading-spinner"})});var n,i,s,r,a,o,l,c,d,u,b,p,m,j,f,g,x,O,y,k,S,w,A=this.getAnnualDiscount();return(null===(n=this.state)||void 0===n||null===(i=n.selectedAddons)||void 0===i?void 0:i.length)&&(S=this.state.selectedAddons.map((function(e){var n=e.prices.filter((function(e){return e.billing_period===t.state.period}))[0],i="month"===t.state.period?N(it(n.cost,n.billing_period),{symbol:"$"}):N(nt(n.cost,n.billing_period),{symbol:"$"});return Object(Ie.jsxs)("div",{className:"grey",children:[Object(Ie.jsx)("span",{children:e.name}),Object(Ie.jsx)("span",{children:i})]},e.name)}))),(null===(s=this.state)||void 0===s?void 0:s.availableAddons)&&(w=this.state.availableAddons.map((function(e){var n,i,s,r,a=Object.assign({},e),o=Object(Ie.jsx)("button",{className:"gh-btn gh-btn-sm",onClick:function(){return t.addAddonToCheckout(a)},children:"Add"});(null===(n=t.state)||void 0===n?void 0:n.selectedAddons)&&(null===(i=t.state)||void 0===i?void 0:i.selectedAddons.length)&&t.state.selectedAddons.find((function(e){return e.name===a.name}))&&(o=(null===(s=t.state)||void 0===s||null===(r=s.currentSite)||void 0===r?void 0:r.subdirectory)?Object(Ie.jsx)("div",{className:"gh-btn gh-btn-green gh-btn-sm disabled ",children:"Active"}):Object(Ie.jsx)("button",{className:"gh-btn gh-btn-grey gh-btn-sm",onClick:function(){return t.removeAddonFromCheckout(a)},children:"Remove"}));var l=a.prices.find((function(e){return e.billing_period===t.state.period})),c=l.cost,d=l.billing_period;return Object(Ie.jsxs)("div",{className:"box-addon-item",children:[Object(Ie.jsxs)("div",{className:"plandetails-splith",children:[Object(Ie.jsx)("h3",{children:a.name}),Object(Ie.jsx)("div",{children:"month"===t.state.period?Object(Ie.jsxs)(Ie.Fragment,{children:[Object(Ie.jsx)("span",{children:"$"}),N(it(c,d)),Object(Ie.jsx)("small",{children:"/mo"})]}):Object(Ie.jsxs)(Ie.Fragment,{children:[Object(Ie.jsx)("span",{children:"$"}),N(nt(c,d)),Object(Ie.jsx)("small",{children:"/year"})]})})]}),Object(Ie.jsx)("p",{className:"addon-desc ".concat(t.state.showAddon[a.name]?"open":"hidden"),dangerouslySetInnerHTML:{__html:null===a||void 0===a?void 0:a.description}}),Object(Ie.jsxs)("footer",{children:[Object(Ie.jsx)("button",{onClick:function(){return t.toggleAddonDetails(a.name)},children:t.state.showAddon[a.name]?"Hide details \u2191":"Show details \u2192"}),o]})]},a.name)}))),Object(Ie.jsx)("main",{className:"main main-med",children:Object(Ie.jsxs)("div",{className:"checkoutgrid","data-test-id":"plan-summary",children:[Object(Ie.jsxs)("section",{className:"checkoutgrid-main",children:[Object(Ie.jsxs)("div",{className:"box-wrap",children:[Object(Ie.jsx)("div",{className:"box-label",children:"Your plan summary"}),Object(Ie.jsx)("div",{className:"box",children:Object(Ie.jsxs)("div",{className:"plandetails",children:[Object(Ie.jsxs)("div",{className:"plandetails-content",children:[Object(Ie.jsxs)("div",{className:"plandetails-splith ".concat("year"===this.state.period?"annual":""),children:[Object(Ie.jsxs)("h2",{children:[this.state.selectedBaseProduct.name," (",_e(this.state.suitablePrice.billing_period),")"]}),Object(Ie.jsx)("div",{children:"month"===this.state.period?Object(Ie.jsxs)(Ie.Fragment,{children:[Object(Ie.jsx)("span",{children:"$"}),N(it(this.state.suitablePrice.cost,this.state.suitablePrice.billing_period)),Object(Ie.jsx)("small",{children:"/mo"})]}):Object(Ie.jsxs)(Ie.Fragment,{children:[Object(Ie.jsx)("span",{children:"$"}),N(nt(this.state.suitablePrice.cost,this.state.suitablePrice.billing_period)),Object(Ie.jsx)("small",{children:"/year"})]})})]}),Object(Ie.jsxs)("p",{children:["Base plan with ",null===this||void 0===this||null===(r=this.state)||void 0===r||null===(a=r.selectedBaseProduct)||void 0===a||null===(o=a.features)||void 0===o?void 0:o.filter((function(e){return e.indexOf("Everything")<0})).join(", ").toLowerCase()]})]}),Object(Ie.jsxs)("div",{className:"plandetails-selected",children:[Object(Ie.jsxs)("div",{className:"plandetails-selected-content",children:[Object(Ie.jsx)("strong",{children:N(this.state.membersIncluded)}),Object(Ie.jsx)("span",{children:"Members included"})]}),Object(Ie.jsx)(h.b,{to:"/plans",className:"gh-btn gh-btn-outline",disabled:this.state.btnDisabled,children:"Change plan"})]})]})})]}),w&&Object(Ie.jsxs)("div",{className:"box-wrap",children:[Object(Ie.jsx)("div",{className:"box-label",children:"Optional add-ons"}),Object(Ie.jsx)("div",{className:"box box-addon",children:w})]})]}),Object(Ie.jsx)("section",{className:"checkoutgrid-side",children:Object(Ie.jsxs)("div",{className:"checkout-summary",children:[Object(Ie.jsx)("div",{className:"box-label",children:"Billing summary"}),Object(Ie.jsxs)("div",{className:"box",children:[Object(Ie.jsxs)("div",{className:"checkout-summary-switch",children:[Object(Ie.jsx)("button",{className:"month"===this.state.period?"active":null,onClick:function(){return t.togglePeriod("month")},disabled:this.state.btnDisabled||!(null===(l=this.state)||void 0===l?void 0:l.comparablePrice),children:"Monthly"}),Object(Ie.jsx)("button",{className:"year"===this.state.period?"active":null,onClick:function(){return t.togglePeriod("year")},disabled:this.state.btnDisabled||!(null===(c=this.state)||void 0===c?void 0:c.comparablePrice),children:"Yearly"})]}),Object(Ie.jsxs)("div",{className:"checkout-summary-card",children:[Object(Ie.jsxs)("div",{className:"staticfield",children:[Object(Ie.jsxs)("header",{children:[Object(Ie.jsx)("div",{className:"staticfield-label",children:"Credit card"}),Object(Ie.jsx)(Ee,{openModal:this.handleOpenModal,closeModal:this.state.closeModal,title:"Update credit card",openModalTrigger:Object(Ie.jsx)("button",{className:"staticfield-link",disabled:!!(null===(d=this.state.user)||void 0===d?void 0:d.cardType)&&this.state.buttonState.disabled,children:(null===(u=this.state.user)||void 0===u?void 0:u.cardType)?"Edit":"Add"}),children:Object(Ie.jsx)(Ze,{setLoadingState:this.handleNestedLoadingState,closeModal:this.handleCloseModal,userId:null===(b=this.state.user)||void 0===b?void 0:b.id,customerId:(null===(p=this.state.subscription)||void 0===p?void 0:p.customer_id)||(null===(m=this.state)||void 0===m||null===(j=m.user)||void 0===j?void 0:j.stripe_token)})})]}),Object(Ie.jsx)(Je,{user:this.state.user})]}),Object(Ie.jsx)("div",{className:"staticfield",children:Object(Ie.jsxs)("section",{className:"staticfield",children:[Object(Ie.jsxs)("header",{children:[Object(Ie.jsx)("div",{className:"staticfield-label",children:"Invoice details"}),Object(Ie.jsx)(Ee,{openModal:this.handleOpenModal,closeModal:this.state.closeModal,title:"Update invoice details",openModalTrigger:Object(Ie.jsx)("button",{className:"staticfield-link",children:"Edit"}),children:Object(Ie.jsx)(Xe,{closeModal:this.handleCloseModal,invoiceDetails:null===(f=this.state)||void 0===f?void 0:f.invoiceDetails,customerId:(null===(g=this.state.subscription)||void 0===g?void 0:g.customer_id)||(null===(x=this.state)||void 0===x||null===(O=x.user)||void 0===O?void 0:O.stripe_token)})})]}),Object(Ie.jsx)("div",{className:"staticfield-value",dangerouslySetInnerHTML:{__html:(null===(y=this.state)||void 0===y?void 0:y._invoiceDetails)||"<span>Add optional address / billing info</span>"}})]})})]}),Object(Ie.jsxs)("div",{className:"checkout-summary-breakdown",children:[S,A&&Object(Ie.jsxs)(Ie.Fragment,{children:[Object(Ie.jsxs)("div",{className:"grey",children:[Object(Ie.jsx)("span",{children:"Yearly price"}),Object(Ie.jsx)("span",{children:N(12*this.getMonthlyEquivalentPrice(),{symbol:"$"})})]}),Object(Ie.jsxs)("div",{className:"green highlighted",children:[Object(Ie.jsxs)("span",{children:[Object(Ie.jsxs)("strong",{children:[this.getAnnualDiscount({percentage:!0}),"%"]})," discount"]}),Object(Ie.jsxs)("span",{children:["-",N(A,{symbol:"$"})]})]})]}),Object(Ie.jsxs)("div",{children:[Object(Ie.jsxs)("span",{children:["Total per ",this.state.period]}),Object(Ie.jsx)("strong",{children:N(this.getTotalPrice(),{symbol:"$"})})]}),(null===(k=this.state)||void 0===k?void 0:k.proration)<0&&Object(Ie.jsxs)("div",{className:"green highlighted",children:[Object(Ie.jsx)("span",{children:"Credit from last payment"}),Object(Ie.jsx)("span",{children:N(this.state.proration,{symbol:"$"})})]})]}),Object(Ie.jsxs)("div",{className:"checkout-summary-cta",children:[Object(Ie.jsxs)("div",{children:[Object(Ie.jsx)("span",{children:"Amount to be billed now: "}),Object(Ie.jsx)("span",{children:N(this.state.amountDue,{symbol:"$"})})]}),Object(Ie.jsx)(He,Object(v.a)({},this.state.buttonState)),this.state.errors&&Object(Ie.jsx)("div",{className:"form-error",children:Object(Ie.jsx)("p",{className:"error-msg",children:this.state.errors})})]})]})]})})]})})}}]),n}(s.a.Component),jt=Object(p.g)(mt),ft=function(e){Object(d.a)(n,e);var t=Object(u.a)(n);function n(e){var i;return Object(o.a)(this,n),(i=t.call(this,e))._isMounted=!1,i.activeStates=["ACTIVE","CUSTOM","PROXY"],e&&e.showNav(!1),i.state={loading:!0,disableSubmit:!1,closeModal:!1},i.handleOpenModal=i.handleOpenModal.bind(Object(c.a)(i)),i.handleCloseModal=i.handleCloseModal.bind(Object(c.a)(i)),i.handleCloseModalAndOpenContactSupport=i.handleCloseModalAndOpenContactSupport.bind(Object(c.a)(i)),i.handleDomainUpdate=i.handleDomainUpdate.bind(Object(c.a)(i)),i.handleRemoveDomain=i.handleRemoveDomain.bind(Object(c.a)(i)),i.handleEditSubdomain=i.handleEditSubdomain.bind(Object(c.a)(i)),i}return Object(l.a)(n,[{key:"handleOpenModal",value:function(){this.setState({closeModal:!1})}},{key:"handleCloseModal",value:function(e){var t=this,n=e.reload;void 0!==n&&n?(this.setState({loading:!0}),W("currentSite").then((function(e){t.setState({currentSite:e,loading:!1,closeModal:!0}),t.props.showNav(!0)}))):this.setState({closeModal:!0,loading:!1})}},{key:"handleCloseModalAndOpenContactSupport",value:function(e){return e.preventDefault(),this.setState({closeModal:!0}),window.location.href="mailto:support@ghost.org"}},{key:"handleDomainUpdate",value:function(e){return e.preventDefault(),this.props.history.push("/domain/custom")}},{key:"handleEditSubdomain",value:function(e){e.preventDefault(),function(){return Ce.apply(this,arguments)}().then((function(e){return window.parent.location.href="".concat("https://domain.ghost.org","?jwt=").concat(e)}))}},{key:"handleRemoveDomain",value:function(){var e=Object(f.a)(j.a.mark((function e(t){var n,i;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),this.setState({disableSubmit:!0,loading:!0}),this.props.showNav(!1),e.next=5,Se({siteId:this.state.currentSite.id,domain:null});case 5:if(!(n=e.sent).errors){e.next=9;break}return i=n.errors.message,e.abrupt("return",this.setState({disableSubmit:!1,errors:{domain:i}}));case 9:return e.abrupt("return",this.handleCloseModal({reload:!0}));case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"componentDidMount",value:function(){var e=Object(f.a)(j.a.mark((function e(){var t,n;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._isMounted=!0,e.next=3,K("currentSite");case 3:return t=e.sent,e.next=6,Y();case 6:if(n=e.sent,Me.b((function(e){var t,i,s,r;e.setTransactionName("Domain"),e.setUser({email:null===n||void 0===n||null===(t=n.user)||void 0===t?void 0:t.email_address}),e.setContext("billingData",{status:null===n||void 0===n||null===(i=n.subscription)||void 0===i?void 0:i.status,price:null===n||void 0===n||null===(s=n.currentPrice)||void 0===s?void 0:s.nickname,site:null===n||void 0===n||null===(r=n.currentSite)||void 0===r?void 0:r.url,exceededLimits:null===n||void 0===n?void 0:n.exceededLimits,forceUpgrade:null===n||void 0===n?void 0:n.isForceUpgrade}),e.setTag("section","domain")})),n&&!(null===n||void 0===n?void 0:n.errors)){e.next=10;break}return e.abrupt("return",this.props.history.push("/"));case 10:if(!this._isMounted){e.next=21;break}if(!n.forceUpgradeOwner){e.next=14;break}return this.props.showNav(!0),e.abrupt("return",this.props.history.push("/plans"));case 14:if(!n.isGrace){e.next=17;break}return this.props.showNav(!0),e.abrupt("return",this.props.history.push("/"));case 17:if(!n.isIncomplete){e.next=19;break}return e.abrupt("return",this.props.history.push(n.checkoutRoute));case 19:this.setState({currentSite:t,loading:!1}),this.props.showNav(!0);case 21:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){this._isMounted=!1}},{key:"render",value:function(){var e,t,n,i,s,r,a,o,l,c,d,u,b,p,v,m,j,f,g,x,O,y=this,k=null,S=!1,w=null,N=!1,A=Object(Ie.jsx)("button",{className:"staticfield-link",onClick:this.handleEditSubdomain,children:"Edit"});if(null===(e=this.state)||void 0===e||null===(t=e.currentSite)||void 0===t?void 0:t.ssl_status){switch(null===(n=this.state)||void 0===n?void 0:n.currentSite.ssl_status){case"ACTIVE":w=Object(Ie.jsx)("span",{className:"ssl-pill",children:"activated"});break;case"NONE":case"PENDING":N=!0,w=Object(Ie.jsx)("span",{className:"ssl-pill pending",children:"pending"});break;case"FAILED":w=Object(Ie.jsx)("span",{className:"ssl-pill failed",children:"failed"});break;case"INVALID":w=Object(Ie.jsx)("span",{className:"ssl-pill failed",children:"invalid"});break;case"PROXY":w=Object(Ie.jsx)("span",{className:"ssl-pill proxy",children:"proxy"})}this.activeStates.includes(this.state.currentSite.ssl_status)&&(A=Object(Ie.jsx)("div",{className:"tooltip t-left","data-tooltip-text":"Can't edit with active custom domain",tabIndex:"1",children:Object(Ie.jsx)("span",{className:"staticfield-link disabled",children:"Edit"})}))}else w=null;(null===(i=this.state)||void 0===i?void 0:i.errors)?(S=!0,k=(null===(j=this.state)||void 0===j?void 0:j.errors)&&(null===(f=this.state)||void 0===f||null===(g=f.errors)||void 0===g?void 0:g.status)&&403===(null===(x=this.state)||void 0===x||null===(O=x.errors)||void 0===O?void 0:O.status)?Object(Ie.jsxs)(Ie.Fragment,{children:["You\u2019re on a special legacy plan, if you need to make any billing changes please reach out to us on ",Object(Ie.jsx)("a",{href:"mailto:support@ghost.org",onClick:this.handleCloseModalAndOpenContactSupport,children:"support@ghost.org"})]}):Object(Ie.jsxs)(Ie.Fragment,{children:["Please contact ",Object(Ie.jsx)("a",{href:"mailto:support@ghost.org",onClick:this.handleCloseModalAndOpenContactSupport,children:"support@ghost.org"})," for changes to your billing."]})):S=!1;return Object(Ie.jsx)("main",{className:"main",children:Object(Ie.jsx)("div",{className:"accountgrid","data-test-id":"dashboard",children:this.state.loading?Object(Ie.jsx)("div",{className:"gh-loading-content",children:Object(Ie.jsx)("div",{className:"gh-loading-spinner"})}):S?Object(Ie.jsx)("p",{style:{textAlign:"center",gridColumn:"1 / 3"},children:k}):Object(Ie.jsxs)(Ie.Fragment,{children:[Object(Ie.jsx)("div",{className:"box-domain box-wrap",children:Object(Ie.jsxs)("div",{className:"box",children:[Object(Ie.jsxs)("section",{className:"staticfield",children:[Object(Ie.jsxs)("header",{children:[Object(Ie.jsx)("div",{className:"staticfield-label",children:"Ghost.io"}),A]}),Object(Ie.jsxs)("div",{className:"staticfield-value",children:[(null===(s=this.state)||void 0===s||null===(r=s.currentSite)||void 0===r?void 0:r.subdomain)||"yourdomain",".",(null===(a=this.state)||void 0===a||null===(o=a.currentSite)||void 0===o?void 0:o.pro_domain)||"ghost.io"]})]}),(null===(l=this.state)||void 0===l||null===(c=l.currentSite)||void 0===c?void 0:c.external_domain)?Object(Ie.jsxs)("section",{className:"staticfield",children:[Object(Ie.jsxs)("header",{children:[Object(Ie.jsxs)("div",{className:"staticfield-label",children:["Custom ",w]}),Object(Ie.jsx)(Ee,{openModal:this.handleOpenModal,closeModal:this.state.closeModal,title:"Update domains",openModalTrigger:Object(Ie.jsx)("button",{className:"staticfield-link",children:"Edit"}),children:N?Object(Ie.jsxs)(Ie.Fragment,{children:[Object(Ie.jsx)("p",{className:"gh-modal-text-only",children:"We're still working on activating your domain. Would you like to remove it or refresh the page?"}),Object(Ie.jsxs)("div",{className:"button-group button-group-right",children:[Object(Ie.jsx)("button",{className:"gh-btn gh-btn-red",type:"button",onClick:this.handleRemoveDomain,children:"Remove"}),Object(Ie.jsx)("button",{className:"gh-btn",type:"button",autoFocus:!0,onClick:function(){return y.handleCloseModal({reload:!0})},children:"Refresh"})]})]}):Object(Ie.jsxs)(Ie.Fragment,{children:[Object(Ie.jsx)("p",{className:"gh-modal-text-only",children:"Would you like to update or remove the custom domain?"}),Object(Ie.jsxs)("div",{className:"button-group button-group-right",children:[Object(Ie.jsx)("button",{className:"gh-btn gh-btn-red",type:"button",onClick:this.handleRemoveDomain,children:"Remove"}),Object(Ie.jsx)("button",{className:"gh-btn",type:"button",autoFocus:!0,onClick:this.handleDomainUpdate,children:"Update"})]})]})})]}),Object(Ie.jsxs)("div",{className:"staticfield-value",children:["https://",null===(d=this.state)||void 0===d||null===(u=d.currentSite)||void 0===u?void 0:u.external_domain,"/",null===(b=this.state)||void 0===b||null===(p=b.currentSite)||void 0===p?void 0:p.subdirectory]})]}):Object(Ie.jsxs)("section",{className:"staticfield",children:[Object(Ie.jsx)("header",{children:Object(Ie.jsx)("div",{className:"staticfield-label",children:"Custom"})}),Object(Ie.jsx)("div",{className:"staticfield-value",children:null===(v=this.state)||void 0===v||null===(m=v.currentSite)||void 0===m?void 0:m.external_domain}),Object(Ie.jsx)(h.b,{className:"gh-btn gh-btn-block gh-btn-green",to:"/domain/custom",children:"Setup \u2192"})]})]})}),Object(Ie.jsx)("div",{className:"box-domain-help box-wrap",children:Object(Ie.jsx)("div",{className:"box",children:Object(Ie.jsxs)("section",{className:"staticfield",children:[Object(Ie.jsxs)("header",{children:[Object(Ie.jsx)("div",{className:"staticfield-label",children:"Docs/help"}),Object(Ie.jsx)("a",{className:"staticfield-link",href:"https://ghost.org/help/",target:"_blank",rel:"noopener noreferrer",children:"More docs \u2192"})]}),Object(Ie.jsxs)("div",{className:"invoices domain-docs",children:[Object(Ie.jsx)("a",{href:"https://ghost.org/help/change-ghost-io-subdomain/",target:"_blank",rel:"noopener noreferrer",children:"Change ghost.io subdomain"}),Object(Ie.jsx)("a",{href:"https://ghost.org/help/using-custom-domains/",target:"_blank",rel:"noopener noreferrer",children:"Using custom domain"})]})]})})})]})})})}}]),n}(s.a.Component),gt=Object(p.g)(ft),xt=function(e){Object(d.a)(n,e);var t=Object(u.a)(n);function n(e){var i;return Object(o.a)(this,n),(i=t.call(this,e))._isMounted=!1,i.finalStates=["ACTIVE","FAILED","PROXY","CUSTOM","INVALID","DEFUNCT"],i.failedStates=["FAILED","INVALID","DEFUNCT"],i.successStates=["ACTIVE","PROXY","CUSTOM"],i.pendingStates=["PENDING","NONE","CUSTOMNEXT"],i.buttonStates={success:{className:"gh-btn gh-btn-block gh-btn-green",html:"Continue &rarr;",onSubmit:function(e){return i.reloadAndBack(e)},onBack:function(e){return i.reloadAndBack(e)},disabled:!1},fail:{className:"gh-btn gh-btn-block gh-btn-red",html:"Try again",onSubmit:function(e){return i.handleSubmit(e)},onBack:function(e){return i.reloadAndBack(e)},disabled:!1},pending:{className:"gh-btn gh-btn-block spinner",html:'<span><div class="gh-spinner"></div></span>',onBack:function(e){return i.reloadAndBack(e)},disabled:!0},default:{className:"gh-btn gh-btn-block",html:"Activate",onSubmit:function(e){return i.handleSubmit(e)},disabled:!0},update:{className:"gh-btn gh-btn-block",html:"Update",onSubmit:function(e){return i.handleSubmit(e)},disabled:!1}},e&&e.showNav&&e.showNav(!1),i.state={loading:!0,disableSubmit:!1,disableInput:!1,newDomain:null,buttonState:i.buttonStates.default},i.handleInputChange=i.handleInputChange.bind(Object(c.a)(i)),i.handleSubmit=i.handleSubmit.bind(Object(c.a)(i)),i.handleOpenModal=i.handleOpenModal.bind(Object(c.a)(i)),i.handleCopyTextAndCloseModal=i.handleCopyTextAndCloseModal.bind(Object(c.a)(i)),i.pollSite=i.pollSite.bind(Object(c.a)(i)),i.reloadAndBack=i.reloadAndBack.bind(Object(c.a)(i)),i}return Object(l.a)(n,[{key:"reloadAndBack",value:function(){var e=Object(f.a)(j.a.mark((function e(t){var n=this;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.preventDefault(),this.state.timeOutId&&clearTimeout(this.state.timeOutId),this.setState({buttonState:this.buttonStates.default,disableInput:!0,loading:!0}),this.props.showNav(!1),W("currentSite").then((function(e){return n.setState({currentSite:e,loading:!1}),n.props.showNav(!0),n.props.history.push("/domain")}));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"handleSubmit",value:function(){var e=Object(f.a)(j.a.mark((function e(t){var n,i,s=this;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),this.setState({disableInput:!0,buttonState:this.buttonStates.pending}),e.prev=2,e.next=5,Se({siteId:this.state.currentSite.id,domain:this.state.newDomain});case 5:if(!(n=e.sent).errors){e.next=9;break}return i=n.errors.message,e.abrupt("return",this.setState({disableInput:!1,errors:{domain:i},buttonState:this.buttonStates.fail}));case 9:return e.abrupt("return",this.setState({timeOutId:setTimeout((function(){s.pollSite()}),5e3)}));case 12:return e.prev=12,e.t0=e.catch(2),Me.a(e.t0,{tags:{pointer:"handleSubmit"}}),e.abrupt("return",this.setState({disableInput:!1,errors:{domain:(null===e.t0||void 0===e.t0?void 0:e.t0.message)||"Unable to update custom domain"},buttonState:this.buttonStates.fail}));case 16:case"end":return e.stop()}}),e,this,[[2,12]])})));return function(t){return e.apply(this,arguments)}}()},{key:"pollSite",value:function(){var e=Object(f.a)(j.a.mark((function e(){var t,n,i,s=this;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ne({siteId:this.state.currentSite.id});case 2:if(!(t=e.sent).errors){e.next=6;break}return n=t.errors.message,e.abrupt("return",this.setState({disableInput:!1,errors:{domain:n},buttonState:this.buttonStates.fail}));case 6:if(!(null===t||void 0===t?void 0:t.ssl_status)||!this.finalStates.includes(t.ssl_status)){e.next=19;break}if(this.setState({disableInput:!1}),!this.failedStates.includes(t.ssl_status)){e.next=14;break}return i="We weren't able to activate your custom domain. Please contact support.","INVALID"===t.ssl_status&&(i=this.state.newDomain.startsWith("www.")||this.state.newDomain.startsWith("blog.")?"Unable to detect a valid CNAME record for ".concat(this.state.newDomain,"."):"Unable to detect a valid CNAME record for ".concat(this.state.newDomain,". Did you mean to enter www.").concat(this.state.newDomain,"?")),e.abrupt("return",this.setState({errors:{domain:i},buttonState:this.buttonStates.fail}));case 14:if(!this.successStates.includes(t.ssl_status)){e.next=16;break}return e.abrupt("return",this.setState({buttonState:this.buttonStates.success}));case 16:return e.abrupt("return");case 19:if(!(null===t||void 0===t?void 0:t.ssl_status)||!this.pendingStates.includes(t.ssl_status)){e.next=23;break}return e.abrupt("return",this.setState({timeOutId:setTimeout((function(){s.pollSite()}),5e3)}));case 23:return e.abrupt("return",this.setState({errors:{domain:"Please refresh the page to update the status of your domain activation."},buttonState:this.buttonStates.fail}));case 24:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"handleOpenModal",value:function(){this.setState({closeModal:!1})}},{key:"handleCopyTextAndCloseModal",value:function(e){return e.preventDefault(),this.setState({closeModal:!0})}},{key:"handleInputChange",value:function(e){var t,n,i,s=(null===(t=e.target)||void 0===t?void 0:t.value)&&e.target.value.trim().toLowerCase(),r={newDomain:s,errors:null,buttonState:Object(v.a)(Object(v.a)({},this.state.buttonState),{},{disabled:!1})};s||(r.buttonState.disabled=!0),(null===(n=this.state.currentSite)||void 0===n?void 0:n.external_domain)&&(null===(i=this.state.currentSite)||void 0===i?void 0:i.external_domain)!==s&&(r.buttonState=this.buttonStates.update),s&&!s.match(/^[a-z0-9]+([-.]{1}[a-z0-9]+)*\.[a-z]{2,13}$/i)&&(r.buttonState.disabled=!0,r.errors={domain:"Please enter a valid domain"}),this.setState(r)}},{key:"componentDidMount",value:function(){var e=this;this.props.updateTitle("Domain settings"),this._isMounted=!0,Y().then((function(t){var n=t.currentSite,i=t.isGrace,s=t.forceUpgradeOwner;if(!t||(null===t||void 0===t?void 0:t.errors))return e.props.history.push("/");if(Me.b((function(e){var n,i,s,r;e.setTransactionName("Custom Domain"),e.setUser({email:null===t||void 0===t||null===(n=t.user)||void 0===n?void 0:n.email_address}),e.setContext("billingData",{status:null===t||void 0===t||null===(i=t.subscription)||void 0===i?void 0:i.status,price:null===t||void 0===t||null===(s=t.currentPrice)||void 0===s?void 0:s.nickname,site:null===t||void 0===t||null===(r=t.currentSite)||void 0===r?void 0:r.url,exceededLimits:null===t||void 0===t?void 0:t.exceededLimits,forceUpgrade:null===t||void 0===t?void 0:t.isForceUpgrade}),e.setTag("section","customDomain")})),e._isMounted){var r={currentSite:n,newDomain:n.external_domain,loading:!1,buttonState:e.buttonStates.default,disableInput:!1};if(s)return e.props.showNav(!0),e.props.history.push("/plans");if(i)return e.props.showNav(!0),e.props.history.push("/");e.pendingStates.includes(n.ssl_status)&&(r.buttonState=e.buttonStates.pending,r.disableInput=!0,r.timeOutId=setTimeout((function(){e.pollSite()}),5e3)),e.setState(r),e.props.showNav(!1)}}))}},{key:"componentWillUnmount",value:function(){this._isMounted=!1,this.state.timeOutId&&clearTimeout(this.state.timeOutId)}},{key:"render",value:function(){var e,t,n,i,s,r,a,o,l,c,d,u,b,p=this,m=null,j=!1,f=(null===(e=this.state)||void 0===e||null===(t=e.currentSite)||void 0===t?void 0:t.pro_domain)||"ghost.io";return(null===(n=this.state)||void 0===n?void 0:n.errors)&&(null===(i=this.state)||void 0===i||null===(s=i.errors)||void 0===s?void 0:s.status)&&403===(null===(r=this.state)||void 0===r||null===(a=r.errors)||void 0===a?void 0:a.status)&&(j=!0,m=Object(Ie.jsxs)(Ie.Fragment,{children:["You\u2019re on a special legacy plan, if you need to make any billing changes please reach out to us on ",Object(Ie.jsx)("a",{href:"mailto:support@ghost.org",onClick:this.handleCloseModalAndOpenBeacon,children:"support@ghost.org"})]})),Object(Ie.jsx)("main",{className:"main",children:Object(Ie.jsx)("div",{className:"domain","data-test-id":"domain",children:this.state.loading?Object(Ie.jsx)("div",{className:"gh-loading-content",children:Object(Ie.jsx)("div",{className:"gh-loading-spinner"})}):j?Object(Ie.jsx)("p",{style:{textAlign:"center",gridColumn:"1 / 3"},children:m}):Object(Ie.jsxs)("div",{className:"domaingrid",children:[Object(Ie.jsxs)("header",{children:[(null===this||void 0===this||null===(o=this.state)||void 0===o||null===(l=o.buttonState)||void 0===l?void 0:l.onBack)?Object(Ie.jsx)(h.b,{to:"/domain",className:"link-back",onClick:function(e){return p.state.buttonState.onBack(e)},children:"\u2190 Back"}):Object(Ie.jsx)(h.b,{to:"/domain",className:"link-back",children:"\u2190 Back"}),Object(Ie.jsx)("h2",{children:"Set up custom domain"}),Object(Ie.jsx)("div",{className:"subheader",children:"Add a domain name to use with your site"})]}),Object(Ie.jsx)("div",{className:"box-label",children:"1. Enter the domain you want to use"}),Object(Ie.jsxs)("section",{id:"step-1",className:"domain-form",children:[Object(Ie.jsx)("div",{className:"",children:Object(Ie.jsxs)("div",{children:[Object(Ie.jsx)("label",{htmlFor:"domain",children:"Domain"}),Object(Ie.jsx)("input",{id:"domain",className:"gh-input",type:"domain",required:!0,name:"domain",placeholder:"www.example.com",disabled:this.state.disableInput,autoFocus:!0,autoCorrect:"off",tabIndex:"1",value:this.state.newDomain||"",onChange:function(e){return p.handleInputChange(e)}}),Object(Ie.jsx)("p",{children:Object(Ie.jsx)("a",{href:"https://ghost.org/help/using-custom-domains/",target:"_blank",rel:"noreferrer",children:"Additional docs on setting up custom domains"})})]})}),Object(Ie.jsxs)("div",{className:"domain-help",children:[Object(Ie.jsx)("div",{className:"box-label",children:"Help"}),Object(Ie.jsxs)("p",{className:"domain-help-text",children:["For this setup guide we assume you\u2019ll set up a ",Object(Ie.jsx)("code",{children:"www"})," domain, which is what most people do. You can enter and use different setups too, if you know how to do that."]})]})]}),Object(Ie.jsx)("div",{className:"box-label",children:"2. Create your DNS records"}),Object(Ie.jsxs)("section",{id:"step-2",className:"domain-form",children:[Object(Ie.jsx)("div",{className:"",children:Object(Ie.jsxs)("div",{children:[Object(Ie.jsx)("label",{htmlFor:"domain",children:"DNS records"}),Object(Ie.jsxs)("div",{children:[Object(Ie.jsxs)("p",{children:["Record type: ",Object(Ie.jsx)("strong",{children:"CNAME"}),Object(Ie.jsx)("br",{}),"Host: ",Object(Ie.jsx)("strong",{children:"www"}),Object(Ie.jsx)("br",{}),"Value: ",Object(Ie.jsxs)("strong",{children:[null===(c=this.state.currentSite)||void 0===c?void 0:c.subdomain,".",f]}),Object(Ie.jsx)("br",{})]}),Object(Ie.jsxs)("p",{children:["Record type: ",Object(Ie.jsx)("strong",{children:"A"}),Object(Ie.jsx)("br",{}),"Host: ",Object(Ie.jsx)("strong",{children:"@"}),Object(Ie.jsx)("br",{}),"Value: ",Object(Ie.jsx)("strong",{children:"178.128.137.126"}),Object(Ie.jsx)("br",{})]})]})]})}),Object(Ie.jsx)("div",{children:Object(Ie.jsxs)("div",{className:"domain-help",children:[Object(Ie.jsx)("div",{className:"box-label",children:"Help"}),Object(Ie.jsx)("p",{className:"domain-help-text",children:"Not sure how to do this? We\u2019ve put together some instructions you can copy and paste to send as an email to the company where you purchased your domain name."}),Object(Ie.jsx)(Ee,{closeModal:this.state.closeModal,openModal:this.handleOpenModal,title:"Email template",openModalTrigger:Object(Ie.jsx)("button",{className:"gh-btn gh-btn-block gh-btn-outline green",children:"See instructions"}),children:Object(Ie.jsxs)("form",{className:"gh-form",onSubmit:this.handleCopyTextAndCloseModal,children:[Object(Ie.jsx)("header",{children:Object(Ie.jsx)("h1",{children:"Email your DNS provider"})}),Object(Ie.jsxs)("div",{children:[Object(Ie.jsxs)("div",{className:"invoice-details",children:[Object(Ie.jsx)("p",{children:"Hi there,"}),Object(Ie.jsxs)("p",{children:["I'm trying to setup my domain ",Object(Ie.jsx)("strong",{children:this.state.newDomain})," with Ghost.org and could use some help creating DNS records. Could you please help me create these records?"]}),Object(Ie.jsxs)("p",{children:["Record type: ",Object(Ie.jsx)("strong",{children:"CNAME"}),Object(Ie.jsx)("br",{}),"Host: ",Object(Ie.jsx)("strong",{children:"www"}),Object(Ie.jsx)("br",{}),"Value: ",Object(Ie.jsxs)("strong",{children:[null===(d=this.state.currentSite)||void 0===d?void 0:d.subdomain,".",f]}),Object(Ie.jsx)("br",{})]}),Object(Ie.jsxs)("p",{children:["Record type: ",Object(Ie.jsx)("strong",{children:"A"}),Object(Ie.jsx)("br",{}),"Host: ",Object(Ie.jsx)("strong",{children:"@"}),Object(Ie.jsx)("br",{}),"Value: ",Object(Ie.jsx)("strong",{children:"178.128.137.126"}),Object(Ie.jsx)("br",{})]}),Object(Ie.jsx)("p",{children:"Please let me know when this is done. Thank you for your help!"})]}),Object(Ie.jsx)("button",{className:"gh-btn gh-btn-block",onClick:this.handleCopyTextAndCloseModal,children:"Cool, thanks"})]})]})})]})})]}),Object(Ie.jsx)("div",{className:"box-label",children:"3. Activate custom domain"}),Object(Ie.jsx)("section",{id:"step-3",className:"domain-form step-activate",children:Object(Ie.jsxs)("div",{className:"",children:[Object(Ie.jsx)("div",{children:Object(Ie.jsx)("p",{children:"After you\u2019ve confirmed that the DNS records have been created, hit the button below. It may take up to 20 minutes to activate your domain, so this is a good time for a drink and a stretch!"})}),Object(Ie.jsx)(He,Object(v.a)({},this.state.buttonState)),(null===(u=this.state)||void 0===u||null===(b=u.errors)||void 0===b?void 0:b.domain)&&Object(Ie.jsx)("div",{className:"form-error",children:Object(Ie.jsx)("p",{className:"error-msg",children:this.state.errors.domain})})]})}),Object(Ie.jsx)("footer",{className:"footer",children:Object(Ie.jsx)("a",{href:"https://ghost.org/help/",target:"_blank",rel:"noopener noreferrer",children:"Help"})})]})})})}}]),n}(s.a.Component),Ot=Object(p.g)(xt);function yt(e){var t="pro-nav";return e.showNav||(t="".concat(t," hidden")),Object(Ie.jsxs)("nav",{className:t,children:[Object(Ie.jsx)(h.c,{className:"pro-nav-item",to:"/",activeClassName:"active",isActive:function(e,t){return!t.pathname.match(/domain/i)},children:"Billing"}),Object(Ie.jsx)(h.c,{className:"pro-nav-item",to:"/domain",strict:!0,activeClassName:"active",children:"Domain"})]})}var kt=function(e){Object(d.a)(n,e);var t=Object(u.a)(n);function n(e){var i;return Object(o.a)(this,n),(i=t.call(this,e)).handleShowNav=function(e){i.setState({showNav:e})},i.handleRouteUpdate=function(e){return i.props.history.push(e)},i.state={showNav:null},i.showNav=i.handleShowNav.bind(Object(c.a)(i)),i.handleRouteUpdate=i.handleRouteUpdate.bind(Object(c.a)(i)),x.sendMessage({route:e.history.location.pathname}),i.unlisten=i.props.history.listen((function(e){x.sendMessage({route:e.pathname})})),i}return Object(l.a)(n,[{key:"componentDidMount",value:function(){x.subscribe("routeUpdate",this.handleRouteUpdate)}},{key:"componentWillUnmount",value:function(){this.unlisten()}},{key:"render",value:function(){var e=this;return Object(Ie.jsxs)(Ie.Fragment,{children:[Object(Ie.jsx)(yt,{showNav:this.state.showNav}),Object(Ie.jsxs)(p.d,{children:[Object(Ie.jsx)(p.b,{exact:!0,path:"/",children:Object(Ie.jsx)(et,{updateTitle:this.props.updateTitle,showNav:this.handleShowNav})}),Object(Ie.jsx)(p.b,{exact:!0,path:"/billing",children:Object(Ie.jsx)(et,{updateTitle:this.props.updateTitle,showNav:this.handleShowNav})}),Object(Ie.jsx)(p.b,{exact:!0,path:"/billing/plans",children:Object(Ie.jsx)(bt,{updateTitle:this.props.updateTitle,showNav:this.handleShowNav})}),Object(Ie.jsx)(p.b,{exact:!0,path:"/plans",children:Object(Ie.jsx)(bt,{updateTitle:this.props.updateTitle,showNav:this.handleShowNav})}),Object(Ie.jsx)(p.b,{exact:!0,path:"/domain",children:Object(Ie.jsx)(gt,{updateTitle:this.props.updateTitle,showNav:this.handleShowNav})}),Object(Ie.jsx)(p.b,{exact:!0,path:"/domain/custom",children:Object(Ie.jsx)(Ot,{updateTitle:this.props.updateTitle,showNav:this.handleShowNav})}),Object(Ie.jsx)(p.b,{exact:!0,path:"/checkout/:id",children:Object(Ie.jsx)(jt,{updateTitle:this.props.updateTitle,showNav:this.handleShowNav})}),Object(Ie.jsx)(p.b,{exact:!0,path:"/billing/checkout/:id",children:Object(Ie.jsx)(jt,{updateTitle:this.props.updateTitle,showNav:this.handleShowNav})}),Object(Ie.jsx)(p.b,{exact:!0,path:"/checkout",children:Object(Ie.jsx)(jt,{updateTitle:this.props.updateTitle,showNav:this.handleShowNav})}),Object(Ie.jsx)(p.b,{exact:!0,path:"/billing/checkout",children:Object(Ie.jsx)(jt,{updateTitle:this.props.updateTitle,showNav:this.handleShowNav})}),Object(Ie.jsx)(p.b,{path:"*",render:function(t){var n=t.match.url,i=/\/\/+/g;if(n.match(i)){var s=n.replace(i,"/");return Object(Ie.jsx)(p.a,{to:s})}return Object(Ie.jsx)(et,{updateTitle:e.props.updateTitle})}})]})]})}}]),n}(s.a.Component),St=Object(p.g)(kt),wt=n(338),Nt=n(339),At=n(340),Ct=n(163),Pt=(n(333),Object(b.a)()),Mt=function(e){Object(d.a)(n,e);var t=Object(u.a)(n);function n(e){var i;return Object(o.a)(this,n),(i=t.call(this,e)).handleTitleUpdate=function(e){i.setState({title:e})},i.state={title:"Billing and subscription settings",headerLogo:"".concat("","/logos/ghost-logo-black-01.png")},i.updateAppTitle=i.handleTitleUpdate.bind(Object(c.a)(i)),i}return Object(l.a)(n,[{key:"componentDidMount",value:function(){var e=Math.floor(10*Math.random())+1,t=e>9?e:"0".concat(e),n="".concat("","/logos/ghost-logo-black-").concat(t,".png"),i="production";this.setState({headerLogo:n}),wt.a({dsn:"https://916fe2f5af1a42989d40aa0ae10f4d28@o55869.ingest.sentry.io/6135788",integrations:[new Ct.a.BrowserTracing({routingInstrumentation:Nt.a(Pt)})],release:"b58f41c29b9d6f370b73fa3a23650764fdf65a7d",environment:i,tracesSampleRate:.2,initialScope:{tags:{app:"billing"}}})}},{key:"render",value:function(){return Object(Ie.jsx)(At.a,{children:Object(Ie.jsx)("div",{className:"viewport","data-test-id":"app-container",children:Object(Ie.jsx)("div",{className:"container",children:Object(Ie.jsxs)(h.a,{history:Pt,children:[Object(Ie.jsxs)("header",{className:"mainhead",children:[Object(Ie.jsxs)(h.b,{className:"home-link",to:"/",children:[Object(Ie.jsx)("img",{id:"ghost-logo",src:this.state.headerLogo,alt:"Ghost"}),Object(Ie.jsxs)("svg",{className:"pro-logo-svg",fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 214 114",children:[Object(Ie.jsx)("rect",{width:"214",height:"114",rx:"23",fill:"url(#paint0_linear)"}),Object(Ie.jsx)("rect",{x:"1.5",y:"1.5",width:"211",height:"111",rx:"21.5",stroke:"#000",strokeOpacity:".06",strokeWidth:"3"}),Object(Ie.jsx)("g",{filter:"url(#filter0_d)",children:Object(Ie.jsx)("path",{d:"M42.866 31.639c2.156-.41 4.517-.719 7.084-.924a79.66 79.66 0 017.777-.385c2.67 0 5.339.231 8.008.693 2.72.41 5.16 1.283 7.315 2.618 2.156 1.283 3.901 3.106 5.236 5.467 1.386 2.31 2.08 5.339 2.08 9.086 0 3.285-.591 6.109-1.772 8.47-1.18 2.31-2.746 4.235-4.697 5.775-1.95 1.489-4.184 2.592-6.699 3.311a29.328 29.328 0 01-7.7 1.001h-3.002l-1.849-.154a13.004 13.004 0 01-1.232-.154V85H42.866V31.639zm15.708 7.777c-1.026 0-2.002.051-2.926.154-.924.051-1.668.128-2.233.231V57.28c.206.051.514.103.924.154.41.051.847.103 1.31.154h2.309c1.386 0 2.747-.128 4.081-.385 1.386-.257 2.618-.719 3.696-1.386 1.078-.719 1.925-1.694 2.541-2.926.668-1.232 1.001-2.849 1.001-4.851 0-1.694-.308-3.08-.924-4.158-.616-1.13-1.437-2.028-2.464-2.695-.975-.667-2.104-1.13-3.388-1.386a19.972 19.972 0 00-3.927-.385zm29.615-7.777a66.7 66.7 0 013.773-.539 58.478 58.478 0 014.081-.462c1.386-.103 2.72-.18 4.004-.231a89.176 89.176 0 013.542-.077c2.515 0 4.979.257 7.392.77 2.464.462 4.646 1.283 6.545 2.464a12.88 12.88 0 014.62 4.774c1.181 2.002 1.771 4.492 1.771 7.469 0 2.207-.231 4.132-.693 5.775-.411 1.591-1.001 3.003-1.771 4.235a13.18 13.18 0 01-2.849 3.234 25.14 25.14 0 01-3.542 2.387L128.075 85h-12.166l-10.857-21.098h-6.314V85H88.189V31.639zm16.17 8.085c-1.078 0-2.156.026-3.234.077-1.027.051-1.822.154-2.387.308V55.74h4.158c2.926 0 5.313-.667 7.161-2.002 1.848-1.335 2.772-3.542 2.772-6.622 0-2.31-.719-4.107-2.156-5.39-1.437-1.335-3.542-2.002-6.314-2.002zm27.998 18.326c0-4.363.411-8.29 1.232-11.781.821-3.49 2.079-6.417 3.773-8.778 1.694-2.413 3.799-4.26 6.314-5.544 2.567-1.283 5.57-1.925 9.009-1.925 3.696 0 6.827.693 9.394 2.079a16.835 16.835 0 016.237 5.775c1.643 2.464 2.823 5.416 3.542 8.855.77 3.44 1.155 7.212 1.155 11.319 0 8.778-1.694 15.657-5.082 20.636-3.337 4.928-8.419 7.392-15.246 7.392-3.696 0-6.853-.693-9.471-2.079-2.567-1.386-4.671-3.311-6.314-5.775-1.591-2.464-2.746-5.416-3.465-8.855-.719-3.44-1.078-7.212-1.078-11.319zm11.088 0c0 2.618.103 5.056.308 7.315.257 2.259.693 4.235 1.309 5.929.667 1.643 1.591 2.952 2.772 3.927 1.232.975 2.849 1.463 4.851 1.463 1.797 0 3.285-.36 4.466-1.078 1.181-.77 2.13-1.925 2.849-3.465.719-1.54 1.206-3.465 1.463-5.775.308-2.361.462-5.133.462-8.316a79.33 79.33 0 00-.308-7.161c-.154-2.259-.565-4.235-1.232-5.929-.616-1.694-1.54-3.029-2.772-4.004-1.232-1.027-2.875-1.54-4.928-1.54-3.593 0-6.032 1.566-7.315 4.697-1.283 3.131-1.925 7.777-1.925 13.937z",fill:"#fff"})}),Object(Ie.jsxs)("defs",{children:[Object(Ie.jsxs)("linearGradient",{id:"paint0_linear",x1:"151",y1:"114",x2:"66.316",y2:"-11.129",gradientUnits:"userSpaceOnUse",children:[Object(Ie.jsx)("stop",{stopColor:"#009B7F"}),Object(Ie.jsx)("stop",{offset:"1",stopColor:"#60D20D"})]}),Object(Ie.jsxs)("filter",{id:"filter0_d",x:"38.866",y:"28.022",width:"138.147",height:"64.056",filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB",children:[Object(Ie.jsx)("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),Object(Ie.jsx)("feColorMatrix",{in:"SourceAlpha",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"}),Object(Ie.jsx)("feOffset",{dy:"2"}),Object(Ie.jsx)("feGaussianBlur",{stdDeviation:"2"}),Object(Ie.jsx)("feColorMatrix",{values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.1 0"}),Object(Ie.jsx)("feBlend",{in2:"BackgroundImageFix",result:"effect1_dropShadow"}),Object(Ie.jsx)("feBlend",{in:"SourceGraphic",in2:"effect1_dropShadow",result:"shape"})]})]})]})]}),Object(Ie.jsx)("p",{dangerouslySetInnerHTML:{__html:this.state.title}})]}),Object(Ie.jsx)(St,{updateTitle:this.handleTitleUpdate})]})})})})}}]),n}(s.a.Component);a.a.render(Object(Ie.jsx)(s.a.StrictMode,{children:Object(Ie.jsx)(Mt,{})}),document.getElementById("root"))}},[[334,1,2]]]);
//# sourceMappingURL=main.b3afd5b7.chunk.js.map